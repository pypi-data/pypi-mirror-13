(function(){RBCommentType={};RBCommentType.configuredTypes=[];var CommentTypeUtilMixin={selectExistingType:function(type,$select){var allowEmpty=RBCommentType.configuredTypes.length&&RBCommentType.configuredTypes[0].length===0;if(type){$select.val(type)}else{if(!allowEmpty){$select.prepend("<option selected/>")}}}};RBCommentType.CommentDialogHookView=Backbone.View.extend(_.extend({events:{"change select":"_onTypeChanged"},template:_.template(['<label for="<%- id %>">Type: </label>','<select id="<%- id %>">'," <% _.each(types, function(type) { %>",'  <option value="<%- type %>"><%- type %></option>'," <% }); %>","</select>"].join("")),initialize:function(options){this.commentDialog=options.commentDialog;this.commentEditor=options.commentEditor},render:function(){var $li=$('<li class="comment-type" />').html(this.template({id:"comment_type_"+this.commentEditor.cid,types:RBCommentType.configuredTypes}));this.$(".comment-type").remove();this.$(".comment-dlg-options").append($li);this._$select=$li.find("select").bindVisibility(this.commentEditor,"canEdit");this.selectExistingType(this.commentEditor.getExtraData("commentType"),this._$select);return this},_onTypeChanged:function(){this.commentEditor.setExtraData("commentType",this._$select.val())}},CommentTypeUtilMixin));RBCommentType.ReviewDialogCommentHookView=Backbone.View.extend(_.extend({events:{"change select":"_onTypeChanged"},template:_.template(['<label for="<%- id %>">Type: </label>','<select id="<%- id %>">'," <% _.each(types, function(type) { %>",'  <option value="<%- type %>"><%- type %></option>'," <% }); %>","</select>"].join("")),render:function(){this.$el.html(this.template({id:"comment_type_"+this.model.id,types:RBCommentType.configuredTypes}));this._$select=this.$("select");this.selectExistingType(this.model.get("extraData").commentType,this._$select);return this},_onTypeChanged:function(){var extraData=this.model.get("extraData");extraData.commentType=this._$select.val();this.model.set("extraData",extraData)}},CommentTypeUtilMixin));RBCommentType.Extension=RB.Extension.extend({initialize:function(){_super(this).initialize.call(this);new RB.CommentDialogHook({extension:this,viewType:RBCommentType.CommentDialogHookView});new RB.ReviewDialogCommentHook({extension:this,viewType:RBCommentType.ReviewDialogCommentHookView})}})}).call(this);
