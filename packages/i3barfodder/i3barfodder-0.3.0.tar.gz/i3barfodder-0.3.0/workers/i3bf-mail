#!/usr/bin/env python3
#
# Released under GPL3 terms (see LICENSE)


from i3bfutils import (mail, template, io)
import os

ACCOUNT = io.get_var('ACCOUNT')

default_format = '({unseen} new mail(s?{_unseen}!=1)?{_unseen}>0)'
LAYOUT = io.get_var('LAYOUT', default=default_format)

tmplt = template.Template(LAYOUT)
account = mail.get_account(ACCOUNT)
info = template.PrettyDict(seen=account.seen_count,
                           unseen=account.unseen_count)

io.push(tmplt.make_blocks(info, init=True))

def handle_change(unseen, seen):
    info.update(unseen=unseen, seen=seen)
    io.push(tmplt.make_blocks(info))

account.on_change(handle_change)
