---
safeMode: False
---
# Amsterdam in Europe
locationId: EU7
regionId: dd-eu

blueprints:

  # primary sql server
  - sql:
      domain:
        name: VDC1
        ipv4: 2
      ethernet:
        name: databases
        subnet: 10.0.0.0
        accept:
          - EU6::databases
      nodes:
        - masterSQL:
            description: '#sql #vdc1 #primary'
            cpu: 8
            memory: 32
            glue:
              - internet 22
            monitoring: essentials
            running: always
            cloud-config:
              disable_root: false
              ssh_pwauth: true
              bootcmd:
                - echo "mysql-server mysql-server/root_password password {{ mysql_root.secret }}" | sudo debconf-set-selections
                - echo "mysql-server mysql-server/root_password_again password {{ mysql_root.secret }}" | sudo debconf-set-selections
              packages:
                - ntp
                - mysql-server
              write_files:
                - path: /root/master_db.sql
                  content: |
                    create database replic01;
                    create user 'dbuser'@'localhost' identified by '{{ random.secret }}';
                    grant all privileges on replic01.* to 'dbuser'@'localhost';
                    flush privileges;
                    drop database test;
                    drop user 'test'@'localhost';
                    flush privileges;
              runcmd:
                - mysql -e "source /root/wordpress_db.sql"
                - mysqladmin -u root password '{{ random.secret }}'

---
# Frankfurt in Europe
locationId: EU6
regionId: dd-eu

blueprints:

  # secondary sql server
  - sql:
      domain:
        name: VDC2
        ipv4: 2
      ethernet:
        name: databases
        subnet: 10.0.0.0
        accept:
          - EU7::databases
      nodes:
        - slaveSQL:
            description: '#sql #vdc2 #secondary'
            cpu: 8
            memory: 32
            glue:
              - internet 22
            monitoring: essentials
            cloud-config:
              disable_root: false
              ssh_pwauth: true
              bootcmd:
                - echo "mysql-server mysql-server/root_password password {{ mysql_root.secret }}" | sudo debconf-set-selections
                - echo "mysql-server mysql-server/root_password_again password {{ mysql_root.secret }}" | sudo debconf-set-selections
              packages:
                - ntp
                - mysql-server
              write_files:
                - path: /root/slave_db.sql
                  content: |
                    create database replic01;
                    create user 'dbuser'@'localhost' identified by '{{ random.secret }}';
                    grant all privileges on replic01.* to 'dbuser'@'localhost';
                    flush privileges;
                    drop database test;
                    drop user 'test'@'localhost';
                    flush privileges;
              runcmd:
                - mysql -e "source /root/wordpress_db.sql"
                - mysqladmin -u root password '{{ random.secret }}'

