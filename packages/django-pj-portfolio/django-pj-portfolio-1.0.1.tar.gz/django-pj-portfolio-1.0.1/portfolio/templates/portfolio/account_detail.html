{% extends "portfolio:portfolio/portfolio_base.html" %}

{% load humanize %}
{% load pjcore_tags %}

{% block title %}One Account{% endblock %}

{% block portfolio_page_title %}
Account
{% endblock portfolio_page_title %}

<h3>{{ account.name }}</h3>

{% block portfolio_content %}
  <ul class="nav nav-tabs" id="portfilio_tab">
    <li class="active"><a href="#summary" data-toggle="tab">Summary</a></li>
    <li><a href="#performance" data-toggle="tab">Performance</a></li>
  </ul>
  <div id="content" class="tab-content">
    <div class="tab-pane active" id="summary">
      <table id="shareDetail" class="tablesorter">
	<thead>
	  <tr>
	    <th>Security</th>
	    <th class="nobreak">Last Price
	     <div>
		 <div class="nobreak t">Date</div>
	     </div>
	    </th>
	    <th>Change</th>
	    <th>Average price </th>
	    <th>Shares</th>
	    <th>Mkt Value</th>
	    <th>Folio Percentage </th> 
	    <th>Overall return </th>
	  </tr>
	</thead>
	<tbody>
	  {% for security, data in account.positions.items %}
	    {% if security != '$CASH' and data.shares >= 1 %}
	      <tr>
		<td>{{ security }}</td>
		<td>{{ data.price|floatformat:2 }} 
		 <div>
		     <div class="nobreak topborder"> {{ data.latest_date|date:"d-M-Y"  }} </div>
		 </div>
		</td>
		<td> 
		    <span class="{{ data.change|colorize_percentage }}">
			{{ data.change|floatformat:2}} 
		    </span> 
		 <div>
		     <div class="topborder"> 
			 <span class="{{ data.change|colorize_percentage }}">  
			     {{ data.change_percentage|floatformat:2 }} % 
			 </span>
		     </div>
		 </div>
		</td>
		<td>{{ data.average|floatformat:2|intcomma }}</td>
		<td>{{ data.shares|floatformat:2 }}</td>
		<td>{{ data.mktval|floatformat:2|intcomma }}</td>
		<td> {{ data.folio_percentage|floatformat:2|intcomma }} % </td>
		<td>
		    <span class="{{ data.total_return|colorize_percentage }}"> 
			{{ data.total_return|floatformat:2 }} %
		    </span>
		</td>
	      </tr>
	    {% endif %}
	  {% endfor %}
	</tbody>
	<tbody class="tablesorter-no-sort">
	  <tr>
	    <th>Cash:</th>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>{{ account.cash.basis|floatformat:2|intcomma }}</td>
	    <td>&nbsp;</td>
	    <td>{{ account.cash.total_return|floatformat:2|intcomma }} %</td>
	  </tr>
	  <tr>
	    <th>Total:</th>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>{{ account.average|floatformat:2|intcomma }}</td>
	    <td>{{ account.mktval|floatformat:2|intcomma }}</td>
	    <td>&nbsp;</td>
	    <td>{{ account.total_return|floatformat:2|intcomma }} %</td>
	  </tr>
	</tbody>
      </table>
    </div> <!-- tab summary -->
    <div class="tab-pane" id="performance">
      <table id="sharePerformance" class="tablesorter">
	<thead>
	  <tr>
	    <th>Security</th>
	    <th class="nobreak">Last Price
	       <div>
		   <div class="nobreak t">Date</div>
	       </div>
	    </th>
	    <th>Average price </th>
	    <th>Shares</th>
	    <th>Cost Basis</th>
	    <th>Mkt Value</th>
	    <th>Sells</th>
	    <th>Gain</th>
	    <th>Dividends</th>
	    <th>Overall return </th>
	  </tr>
	</thead>
	<tbody>
	  {% for security, data in account.positions.items %}
	    {% if security != '$CASH' and data.shares >= 1 %}
	      <tr>
		<td>{{ security }}</td>
		<td>{{ data.price|floatformat:2 }} 
		   <div>
		       <div class="nobreak topborder"> 
			   {{ data.latest_date|date:"d-M-Y"  }} 
		       </div>
		   </div>
		</td>
		<td>{{ data.average|floatformat:2|intcomma }}</td>
		<td>{{ data.shares|floatformat:2 }}</td>
		<td>{{ data.basis|floatformat:2|intcomma }}</td>
		<td>{{ data.mktval|floatformat:2|intcomma }}</td>
		<td>{{ data.sold|floatformat:2|intcomma }}</td>
		<td>{{ data.gain|floatformat:2|intcomma }}</td>
		<td>{{ data.dividends|floatformat:2|intcomma }}</td>
		<td>
		    <span class="{{ data.total_return|colorize_percentage }}"> 
			{{ data.total_return|floatformat:2 }} %
		    </span>
		</td>
	      </tr>
	    {% endif %}
	  {% endfor %}
	</tbody>
	<tbody class="tablesorter-no-sort">
	  <tr>
	    <th>Cash:</th>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>{{ account.cash.basis|floatformat:2|intcomma }}</td>
	    <td>{{ account.cash.mktval|floatformat:2|intcomma }}</td>
	    <td>&nbsp;</td>
	    <td>{{ account.cash.gain|floatformat:2|intcomma }}</td>
	    <td>&nbsp;</td>
	    <td>{{ account.cash.total_return|floatformat:2|intcomma }} %</td>
	  </tr>
	  <tr>
	    <th>Total:</th>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>&nbsp;</td>
	    <td>{{ account.basis|floatformat:2|intcomma }}</td>
	    <td>{{ account.mktval|floatformat:2|intcomma }}</td>
	    <td>{{ account.sells|floatformat:2|intcomma }}</td>
	    <td>{{ account.gain|floatformat:2|intcomma }}</td>
	    <td>{{ account.dividends|floatformat:2|intcomma }}</td>
	    <td>{{ account.total_return|floatformat:2|intcomma }} %</td>
	  </tr>
	</tbody>
      </table>
    </div> <!-- tab performance -->
  </div><!-- end content -->
  
{% endblock portfolio_content %}
