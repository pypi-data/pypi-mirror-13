(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.nbpresentNotebook = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CellManager=void 0;var _standalone=require("./standalone"),_namespace=require("base/js/namespace"),_namespace2=_interopRequireDefault(_namespace),CellManager=exports.CellManager=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getCells",value:function(){return _namespace2["default"].notebook.get_cells().reduce(function(e,t){return t.metadata.nbpresent&&(e[t.metadata.nbpresent.id]=t),e},{})}}]),t}(_standalone.CellManager);

},{"./standalone":2,"base/js/namespace":"base/js/namespace"}],2:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CellManager=void 0;var _nbpresentDeps=require("nbpresent-deps"),_parts=require("../parts");window.html2canvas=_nbpresentDeps.html2canvas;var _thumbs={},CellManager=exports.CellManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getCells",value:function(){var e={};return _nbpresentDeps.d3.selectAll(".cell").each(function(){var t=_nbpresentDeps.d3.select(this),n=t.attr("data-nbpresent-id");n&&(e[n]={element:[t.node()]})}),e}},{key:"getPart",value:function(e){var t=this.getCells()[e.cell];if(!t)return null;var n=_nbpresentDeps.d3.select(t.element[0]),r=n.select(_parts.PART_SELECT[e.part]);return r}},{key:"thumbnail",value:function(e){var t=e.cell+"-"+e.part;if(!_thumbs[t]){var n=this.getPart(e);if(n=n?n.node():null,!n)return Promise.reject(e);_thumbs[t]=(0,_nbpresentDeps.html2canvas)(n).then(function(e){return{canvas:e,uri:e.toDataURL("image/png"),width:e.width,height:e.height}},function(e){console.log(e)})}return _thumbs[t]}}]),e}();

},{"../parts":10,"nbpresent-deps":"nbpresent-deps"}],3:[function(require,module,exports){
"use strict";function bbox(){function e(e){var t=_nbpresentDeps.d3.behavior.drag().origin(function(e,t){return{x:this.getAttribute("x"),y:this.getAttribute("y")}}).on("drag.lbbbox",o).on("dragstart.lbbbox",r).on("dragend.lbbbox",_);return e.call(t),e.on("mousemove.lbbbox",n),e.on("mouseleave.lbbbox",s),e}function t(e,t){return Math.max(t[0],Math.min(e,t[1]))}function i(e,t){var i="",n=+t.getAttribute("x"),s=+t.getAttribute("y"),r=+t.getAttribute("width"),_=+t.getAttribute("height");return e[1]<s+l.n?i+="n":e[1]>s+_-l.s&&(i+="s"),e[0]<n+l.w?i+="w":e[0]>n+r-l.e&&(i+="e"),""==i&&(a.indexOf("x")>-1||a.indexOf("y")>-1)?i="M":-1==a.indexOf(i)&&(i=""),i}function n(e,t){if(void 0===this.__resize_action__&&d){var n=i(_nbpresentDeps.d3.mouse(this),this),s=a.indexOf("x"),r=a.indexOf("y");"M"==n&&0>1/(s*r)?document.body.style.cursor=s>=0?d.x:d.y:document.body.style.cursor=d[n]||null}}function s(e,t){void 0===this.__resize_action__&&d&&(document.body.style.cursor=null)}function r(e,t){this.__resize_action__=i(_nbpresentDeps.d3.mouse(this),this),this.__ow__=+this.getAttribute("width"),this.__oh__=+this.getAttribute("height"),"M"==this.__resize_action__?b.dragstart&&b.dragstart.call(this,e,t):this.__resize_action__.length&&b.resizestart&&b.resizestart.call(this,e,t)}function _(e,t){"M"==this.__resize_action__?b.dragend&&b.dragend.call(this,e,t):this.__resize_action__.length&&b.resizeend&&b.resizeend.call(this,e,t),delete this.__resize_action__,delete this.__ow__,delete this.__oh__,d&&(document.body.style.cursor=null)}function o(e,i){if("M"==this.__resize_action__){if(b.dragmove&&!1===b.dragmove.call(this,e,i))return}else if(this.__resize_action__.length&&b.resizemove&&!1===b.resizemove.call(this,e,i))return;var n="function"==typeof u?u.call(this,e,i):u,s="function"==typeof h?h.call(this,e,i):h;if("M"==this.__resize_action__)a.indexOf("x")>-1&&0!=_nbpresentDeps.d3.event.dx&&this.setAttribute("x",t(t(_nbpresentDeps.d3.event.x,n)+this.__ow__,n)-this.__ow__),a.indexOf("y")>-1&&0!=_nbpresentDeps.d3.event.dy&&this.setAttribute("y",t(t(_nbpresentDeps.d3.event.y,s)+this.__oh__,s)-this.__oh__);else{var r=+this.getAttribute("x"),_=+this.getAttribute("y");if(/^n/.test(this.__resize_action__)){var o=_+ +this.getAttribute("height"),l=t(t(_nbpresentDeps.d3.event.y,s),[-(1/0),o-1]);this.setAttribute("y",l),this.setAttribute("height",o-l)}else if(/^s/.test(this.__resize_action__)){var o=t(_nbpresentDeps.d3.event.y+this.__oh__,s);this.setAttribute("height",t(o-_,[1,1/0]))}if(/w$/.test(this.__resize_action__)){var d=r+ +this.getAttribute("width"),c=t(t(_nbpresentDeps.d3.event.x,n),[-(1/0),d-1]);this.setAttribute("x",c),this.setAttribute("width",d-c)}else if(/e$/.test(this.__resize_action__)){var d=t(_nbpresentDeps.d3.event.x+this.__ow__,n);this.setAttribute("width",t(d-r,[1,1/0]))}}}var u=null,h=null,l=null,a=null,d=null,b={dragstart:null,dragmove:null,dragend:null,resizestart:null,resizemove:null,resizeend:null};return e.xextent=function(t){return arguments.length?(u=t!==!1?t:[-(1/0),+(1/0)],e):u},e.xextent(!1),e.yextent=function(t){return arguments.length?(h=t!==!1?t:[-(1/0),+(1/0)],e):h},e.yextent(!1),e.handlesize=function(t){return arguments.length?(l=+t?{w:t,n:t,e:t,s:t}:t,e):l},e.handlesize(3),e.cursors=function(t){return arguments.length?(d=t!==!0?t:{M:"move",x:"col-resize",y:"row-resize",n:"n-resize",e:"e-resize",s:"s-resize",w:"w-resize",nw:"nw-resize",ne:"ne-resize",se:"se-resize",sw:"sw-resize"},e):d},e.cursors(!0),e.directions=function(t){return arguments.length?(a=t!==!0?t:["n","e","s","w","nw","ne","se","sw","x","y"],e):a},e.directions(!0),e.on=function(t,i){return void 0===i?b[t]:(b[t]=i,e)},e.infect=function(t){return t.call(e),e},e.disinfect=function(t){return t.on(".drag",null),t.on(".lbbbox",null),e},e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.bbox=bbox;var _nbpresentDeps=require("nbpresent-deps");

},{"nbpresent-deps":"nbpresent-deps"}],4:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Editor=void 0;var _nbpresentDeps=require("nbpresent-deps"),_parts=require("./parts"),_regiontree=require("./regiontree"),_notebook=require("./cells/notebook"),_d=require("./d3.bbox"),Editor=function(){function e(t,i){var n=this;_classCallCheck(this,e),this.slide=t,this.selectedRegion=i,this.regions=this.slide.select("regions"),this.cellManager=new _notebook.CellManager,this.x=_nbpresentDeps.d3.scale.linear(),this.y=_nbpresentDeps.d3.scale.linear(),this.initUI(),this.sidebar=new _regiontree.RegionTree(this.slide,this.selectedRegion),this.initBehavior(),this.update(),this.slide.on("update",function(){n.killed||n.update()})}return _createClass(e,[{key:"destroy",value:function(){this.sidebar.destroy(),this.$ui.transition().style({opacity:0}).remove(),this.killed=!0}},{key:"initBehavior",value:function(){this.bbox=(0,_d.bbox)()}},{key:"initUI",value:function(){this.$ui=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_editor:1}).style({opacity:0}),this.$bg=this.$ui.append("div").classed({slide_bg:1}),this.$svg=this.$bg.append("svg"),this.$defs=this.$svg.append("defs"),this.$ui.transition().style({opacity:1})}},{key:"padding",value:function(){return 20}},{key:"aspectRatio",value:function(){return 16/9}},{key:"bbEnd",value:function(e,t){var i=_nbpresentDeps.d3.select(e),n={x:this.x,y:this.y,width:this.x,height:this.y},s=this.selectedRegion.get();s&&this.slide.merge(["regions",s.region,"attrs"],_nbpresentDeps.d3.entries(n).reduce(function(e,t){return e[t.key]=t.value.invert(i.attr(t.key)),e},{}))}},{key:"hasContent",value:function(e){return function(t){return(t.value.content||{}).part===e}}},{key:"update",value:function(){var e=this,t=this,i=this.$ui.node().getBoundingClientRect(),n=i.width-(this.sidebar.width()+2*this.padding()),s=n/this.aspectRatio(),r=_nbpresentDeps.d3.entries(this.regions.get()),a=this.selectedRegion.get()||{},o=(a.slide,a.region,this.selectedRegion.get());s>i.height+2*this.padding()&&(s=i.height-2*this.padding(),n=s*this.aspectRatio()),this.x.range([0,n]),this.y.range([0,s]);var l=this.x,h=this.y;this.$bg.style({left:(i.width+this.sidebar.width()-n)/2+"px",top:(i.height-s)/2+"px",width:n+"px",height:s+"px"}),this.$svg.attr({width:n,height:s}),r.sort(function(e,t){return o&&o.region==e.key?-1:o&&o.region==t.key?1:(e.value.attrs.z||0)-(t.value.attrs.z||0)});var u=this.$svg.selectAll(".region").data(r,function(e){return e.key}).order();u.exit().remove();u.enter().append("g").classed({region:1}).call(function(e){e.append("rect").classed({region_bg:1}).each(function(e){t.bbox.infect(_nbpresentDeps.d3.select(this)).on("dragend",function(e){t.bbEnd(this,e)}).on("resizeend",function(e){t.bbEnd(this,e)})})}).on("mousedown",function(t){e.selectedRegion.set({slide:e.slide.get("id"),region:t.key})}),u.classed({active:function(e){return o&&e.key==o.region},content_source:this.hasContent(_parts.PART.source),content_outputs:this.hasContent(_parts.PART.outputs),content_widgets:this.hasContent(_parts.PART.widgets)}).select(".region_bg").transition().attr({width:function(e){return l(e.value.attrs.width)},height:function(e){return h(e.value.attrs.height)},x:function(e){return l(e.value.attrs.x)},y:function(e){return h(e.value.attrs.y)}}),u.filter(function(e){var t=e.value;return!t.content}).select(".region_bg").style({fill:null}),u.filter(function(e){var t=e.value;return t.content}).each(function(e){var i=_nbpresentDeps.d3.select(this);t.cellManager.thumbnail(e.value.content)["catch"](function(e){console.warn("thumbnail error",e)}).then(function(n){var s=n.uri,r=n.width,a=n.height,o=e.value.content.part+"-"+e.value.content.cell,l=t.$defs.selectAll("#"+o).data([o]);l.enter().append("pattern").attr({patternUnits:"userSpaceOnUse",id:o}).append("image").attr({x:0,y:0}),l.attr({width:r,height:a}).select("image").attr({"xlink:href":s,width:r,height:a}),i.select(".region_bg").style({fill:"url(#"+o+")"})})})}}]),e}();exports.Editor=Editor;

},{"./cells/notebook":1,"./d3.bbox":3,"./parts":10,"./regiontree":13,"nbpresent-deps":"nbpresent-deps"}],5:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.ManualLayout=void 0;var _nbpresentDeps=require("nbpresent-deps"),KEY="manual",ManualLayout=exports.ManualLayout=function(){function e(t,n,a){_classCallCheck(this,e),this.tree=t,this.slide=n,this.container=a}return _createClass(e,[{key:"key",value:function(){return KEY}},{key:"init",value:function(){var e=this.container,t=e.clientWidth,n=e.clientHeight;this.x=_nbpresentDeps.d3.scale.linear().range([0,t]),this.y=_nbpresentDeps.d3.scale.linear().range([0,n])}},{key:"update",value:function(e,t){var n=e.value.attrs,a=n.x,i=n.y,l=n.width,r=n.height,s=n.z;s=s||0,t.style({height:this.y(r)+"px",left:this.x(a)+"px",top:this.y(i)+"px",width:this.x(l)+"px"})}},{key:"clean",value:function(e){e.style({left:null,top:null,width:null,height:null})}}],[{key:"clsKey",value:function(){return KEY}}]),e}();

},{"nbpresent-deps":"nbpresent-deps"}],6:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreemapLayout=void 0;var _nbpresentDeps=require("nbpresent-deps"),_manual=require("./manual"),KEY="treemap",TreemapLayout=exports.TreemapLayout=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"key",value:function(){return KEY}},{key:"init",value:function(){_get(Object.getPrototypeOf(t.prototype),"init",this).call(this);var e=this;this.treemap=_nbpresentDeps.d3.layout.treemap().size([100,100]).sticky(!0).value(function(e){return e._value.attrs["treemap:weight"]||1});var r=_nbpresentDeps.d3.entries(this.slide.value.regions).map(function(e){return e._value=e.value,e});r.filter(function(e){return null==e.value.attrs["treemap:weight"]}).map(function(t){e.tree.merge(["slides",e.slide.key,"regions",t.key,"attrs"],{"treemap:weight":t.value["treemap:weight"]||1})}),this.treemap({children:r}),r.map(function(t){var r=["slides",e.slide.key,"regions",t.key,"attrs"],n=e.tree.get(r),o={x:t.x/100,y:t.y/100,width:t.dx/100,height:t.dy/100},i=void 0;for(var a in o)n[a]!==o[a]&&((i?i:i={})[a]=o[a]);i&&e.tree.merge(r,i)})}}],[{key:"clsKey",value:function(){return KEY}}]),t}(_manual.ManualLayout);

},{"./manual":5,"nbpresent-deps":"nbpresent-deps"}],7:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.MiniSlide=void 0;var _nbpresentDeps=require("nbpresent-deps"),_notebook=require("./cells/notebook"),_parts=require("./parts"),MiniSlide=function(){function e(t){_classCallCheck(this,e),this.selectedRegion=t,this.cellManager=new _notebook.CellManager,this._regions=function(e,t){return e.value.regions},this.update=this.update.bind(this),this.clicked=this.clicked.bind(this)}return _createClass(e,[{key:"regions",value:function(e){return arguments.length?[this._regions=_nbpresentDeps.d3.functor(e),this][1]:this._regions}},{key:"hasContent",value:function(e){return function(t){return(t.region.value.content||{}).part===e}}},{key:"clicked",value:function(e){if(e=e||_nbpresentDeps.d3.select(this).datum(),this.selectedRegion){var t=this.selectedRegion.get()||{},n=t.slide,i=t.region;return n===e.slide.key&&i===e.region.key?this.selectedRegion.set(null):void this.selectedRegion.set({slide:e.slide.key,region:e.region.key})}}},{key:"update",value:function(e){var t=this,n=this;e.classed({mini:1});var i=e.selectAll(".region").data(function(e){return _nbpresentDeps.d3.entries(t._regions(e)).map(function(t){return{slide:e,region:t}})});i.enter().append("div").classed({region:1}).on("click",this.clicked),i.exit().remove();var r=this.selectedRegion&&this.selectedRegion.get()||{},s=r.slide,o=r.region;i.classed({active:function(e){return e.slide.key===s&&e.region.key===o},content_source:this.hasContent(_parts.PART.source),content_outputs:this.hasContent(_parts.PART.outputs),content_widgets:this.hasContent(_parts.PART.widgets)}).style({width:function(e){return 160*e.region.value.attrs.width+"px"},height:function(e){return 90*e.region.value.attrs.height+"px"},left:function(e){return 160*e.region.value.attrs.x+"px"},top:function(e){return 90*e.region.value.attrs.y+"px"}}),i.filter(function(e){return e.region.value.content}).filter(function(e){var t=_nbpresentDeps.d3.select(this);return t.classed("active")||"none"===t.style("background-image")}).each(function(e){var t=_nbpresentDeps.d3.select(this);n.cellManager.thumbnail(e.region.value.content)["catch"](function(e){t.style({background:"#333","background-image":null})}).then(function(e){var n=e.uri;e.width,e.height;t.style({background:null,"background-image":'url("'+n+'")'})})})}}]),e}();exports.MiniSlide=MiniSlide;

},{"./cells/notebook":1,"./parts":10,"nbpresent-deps":"nbpresent-deps"}],8:[function(require,module,exports){
"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mode=void 0;var _nbpresentDeps=require("nbpresent-deps"),Mode=exports.Mode=function e(s){_classCallCheck(this,e),this.root=s,this.init()};

},{"nbpresent-deps":"nbpresent-deps"}],9:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mode=void 0;var _namespace=require("base/js/namespace"),_namespace2=_interopRequireDefault(_namespace),_celltoolbar=require("notebook/js/celltoolbar"),_nbpresentDeps=require("nbpresent-deps"),_notebook=require("../presenter/notebook"),_sorter=require("../sorter"),_parts=require("../parts"),_tour=require("../tour"),_tree=require("../tree"),_base=require("./base"),Mode=exports.Mode=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){var e=this;this.initStylesheet();var t=new _tree.Tree({slides:this.metadata().slides,root:this.root});this.tree=t.tree,this.slides=this.tree.select(["slides"]),this.slides.on("update",function(){return e.metadata(!0)}),this.tour=new _tour.NbpresentTour(this),this.tour.init(),this.presenter=new _notebook.NotebookPresenter(this.tree,this.tour),this.sorter=new _sorter.Sorter(this.tree,this.tour),this.initToolbar()}},{key:"initStylesheet",value:function(){var e=_nbpresentDeps.d3.select("head").selectAll("link#nbpresent-css").data([1]);return e.node()?void console.warn("nbpresent extension already loaded!"):void e.enter().append("link").attr({id:"nbpresent-css"}).attr({rel:"stylesheet",href:this.root+"/nbpresent.min.css"})}},{key:"metadata",value:function(e){var t=_namespace2["default"].notebook.metadata;return e?void(t.nbpresent={slides:this.slides.serialize()}):t.nbpresent||{slides:{}}}},{key:"show",value:function(){this.sorter.show(),this.tour.start(),(0,_nbpresentDeps.$)("#header-container").toggle(),(0,_nbpresentDeps.$)(".header-bar").toggle()}},{key:"present",value:function(){this.presenter.presenting.set(!0)}},{key:"unpresent",value:function(){this.presenter.presenting.set(!1)}},{key:"initToolbar",value:function(){var e=this;(0,_nbpresentDeps.$)("#view_menu").append((0,_nbpresentDeps.$)("<li/>").append((0,_nbpresentDeps.$)("<a/>").text("Toggle Present").on("click",function(){e.show()}))),_namespace2["default"].toolbar.add_buttons_group([{label:"Slide Sorter",icon:"fa-th-large",callback:function(){return e.show()},id:"nbpresent_sorter_btn"},{label:"Present",icon:"fa-youtube-play",callback:function(){return e.present()},id:"nbpresent_present_btn"}]);var t=this,n=[],r=function(e,n){var r=_nbpresentDeps.d3.select(e[0]);r.append("i").attr("class","fa fa-link"),r.append("span").text(" Region ");r.selectAll(".btn").data([_parts.PART.source,_parts.PART.outputs,_parts.PART.widgets]).enter().append("button").classed({btn:1,"btn-default":1,"btn-xs":1}).text(function(e){return e}).on("click",function(e){return t.sorter.linkContent(e)})};_celltoolbar.CellToolbar.register_callback("nbpresent.add_to_region",r),n.push("nbpresent.add_to_region"),_celltoolbar.CellToolbar.register_preset("nbpresent",n,_namespace2["default"].notebook);var s=_nbpresentDeps.d3.select(_nbpresentDeps.d3.select("#download_html").node().parentNode);s.insert("li",":nth-child(4)").append("a").classed({download_nbpresent_html:1}).text("Presentation (.html)").on("click",function(){return e.nbconvert("nbpresent")}),s.insert("li",":nth-child(5)").append("a").classed({download_nbpresent_pdf:1}).text("Presentation (.pdf)").on("click",function(){return e.nbconvert("nbpresent_pdf")})}},{key:"nbconvert",value:function(e){_namespace2["default"].menubar._nbconvert(e,!0)}}]),t}(_base.Mode);

},{"../parts":10,"../presenter/notebook":12,"../sorter":14,"../tour":21,"../tree":22,"./base":8,"base/js/namespace":"base/js/namespace","nbpresent-deps":"nbpresent-deps","notebook/js/celltoolbar":"notebook/js/celltoolbar"}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PART={source:"source",outputs:"outputs",widgets:"widgets"},PART_SELECT={source:".inner_cell",outputs:".output_wrapper",widgets:".widget-area .widget-subarea"};exports.PART=PART,exports.PART_SELECT=PART_SELECT;

},{}],11:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Presenter=void 0;var _nbpresentDeps=require("nbpresent-deps"),_base=require("../speaker/base"),_manual=require("../layout/manual"),_treemap=require("../layout/treemap"),_parts=require("../parts"),_slab=require("../style/slab"),PREFIX=["-webkit-","-moz-","-ms-","-o-",""],Presenter=exports.Presenter=function(){function e(t){var n=this;_classCallCheck(this,e),this.tree=t,this.cellManager=this.makeCellManager(),this.speaker=this.makeSpeaker(this.tree),this.initUI(),this.presenting=this.tree.select(["presenting"]),this.current=this.tree.select(["selectedSlide"]),this.tree.on("update",function(){return n.update()}),this.presenting.on("update",function(){return n.present()}),this.current.on("update",function(){return n.update()})}return _createClass(e,[{key:"makeCellManager",value:function(){throw new Error("Not implemented")}},{key:"makeSpeaker",value:function(e){return new _base.SpeakerBase(e)}},{key:"initUI",value:function(){this.$ui=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_presenter:1}).style({display:"none"})}},{key:"layoutClass",value:function(e){return{manual:_manual.ManualLayout,treemap:_treemap.TreemapLayout}[e.value.layout||"manual"]}},{key:"updateLayout",value:function(e){var t=this.layoutClass(e);this.layout&&this.layout.key()==t.clsKey()&&this.layout.slide.key===e.key?this.layout.slide=e:this.layout=new t(this.tree,e,document.documentElement),this.layout.init()}},{key:"present",value:function(){this.update()}},{key:"getCells",value:function(){return this.cellManager.getCells()}},{key:"update",value:function(){var e=this,t=this.presenting.get();_nbpresentDeps.d3.select("body").classed({nbpresent_presenting:t}),this.$ui.style({display:t?"block":"none"}).style({opacity:+t});var n=this.current.get(),r=this.tree.get(["sortedSlides",function(e){return e.key==n}]);if(!r)return this.current.set(this.tree.get(["sortedSlides",0,"key"]));if(this.updateLayout(r),!t)return this.clean(!0);var s=this.getCells();_nbpresentDeps.d3.selectAll(this.allPartSelect()).classed({nbpresent_unpresent:1,nbpresent_present:0}),_nbpresentDeps.d3.entries(r.value.regions).filter(function(e){var t=e.value;return t.content}).map(function(t){var n=t.value.content,r=s[n.cell];if(r){var a=_nbpresentDeps.d3.select(r.element[0]),l=a.select(_parts.PART_SELECT[n.part]);l.classed({nbpresent_unpresent:0,nbpresent_present:1}).each(function(){return e.layout.update(t,l)}),_nbpresentDeps.d3.entries(t.value.style).map(function(e){if(e.value&&"slab"===e.key){var t=new _slab.SlabStyle;t.update(l)}})}}),this.clean()}},{key:"allPartSelect",value:function(){return _nbpresentDeps.d3.entries(_parts.PART_SELECT).map(function(e){var t=e.value;return".cell "+t}).join(", ")}},{key:"clean",value:function(e){var t=this;e&&_nbpresentDeps.d3.selectAll(this.allPartSelect()).classed({nbpresent_unpresent:1,nbpresent_present:0}),_nbpresentDeps.d3.selectAll(".nbpresent_unpresent").call(t.layout&&this.layout.clean||function(){return 0}).classed({nbpresent_unpresent:0,nbpresent_present:0})}}]),e}();

},{"../layout/manual":5,"../layout/treemap":6,"../parts":10,"../speaker/base":15,"../style/slab":18,"nbpresent-deps":"nbpresent-deps"}],12:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.NotebookPresenter=void 0;var _notebook=require("../cells/notebook"),_notebook2=require("../speaker/notebook"),_base=require("./base"),NotebookPresenter=exports.NotebookPresenter=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"makeCellManager",value:function(){return new _notebook.CellManager}},{key:"makeSpeaker",value:function(e){return new _notebook2.NotebookSpeaker(e)}}]),t}(_base.Presenter);

},{"../cells/notebook":1,"../speaker/notebook":16,"./base":11}],13:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,a=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.RegionTree=void 0;var _nbpresentDeps=require("nbpresent-deps"),_toolbar=require("./toolbar"),_mini=require("./mini"),RegionTree=function(){function e(t,n){_classCallCheck(this,e),this.slide=t,this.selectedRegion=n,this.mini=new _mini.MiniSlide(this.selectedRegion).regions(function(e){var t={};return t[e.region.id]=e.region,t}),this.initUI(),this.update(),this.update=this.update.bind(this),this.slide.on("update",this.update),this.selectedRegion.on("update",this.update)}return _createClass(e,[{key:"destroy",value:function(){this.$ui.transition().style({opacity:0}).remove(),this.killed=!0}},{key:"width",value:function(){return 300}},{key:"layout",value:function(e){this.slide.set("layout",e)}},{key:"initUI",value:function(){var e=this;this.$ui=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_regiontree:1});var t=new _toolbar.Toolbar;this.$toolbar=this.$ui.append("div").datum([[{icon:"plus-square-o",click:function(){return e.addRegion()},tip:"Add Region"}],[{icon:"arrows",click:function(){return e.layout("manual")},tip:"Manual Layout"},{icon:"tree",click:function(){return e.layout("treemap")},tip:"Treemap Layout"}]]).call(t.update)}},{key:"toggleStyle",value:function(e){var t=this.selectedRegion.get()||{},n=(t.slide,t.region),i=["regions",n,"style",e];this.slide.set(i,!this.slide.get(i))}},{key:"addRegion",value:function(){var e=_nbpresentDeps.uuid.v4();this.slide.set(["regions",e],{id:e,attrs:{x:.1,y:.1,width:.8,height:.8}})}},{key:"update",value:function(){if(!this.killed){var e=this,t=_nbpresentDeps.d3.entries(this.slide.get("regions")),n=this.$ui.selectAll(".region_info").data(t,function(e){return e.key}),i=this.slide.get();n.enter().append("div").classed({region_info:1});var r=n.selectAll(".slide").data(function(e){return[{value:i,key:i.id,region:e.value}]});r.enter().append("div").classed({slide:1}),r.exit().transition().style({opacity:0}).remove(),r.call(this.mini.update);var a=this.slide.get(["layout"]),s=n.selectAll(".region_attr").data(function(e){return _nbpresentDeps.d3.entries(e.value.attrs).map(function(t){return{region:e,attr:t}}).filter(function(e){return"treemap"==a?0===e.attr.key.indexOf(a):-1===e.attr.key.indexOf("treemap")})});s.exit().remove(),s.enter().append("div").classed({region_attr:1,"input-group":1,"input-group-sm":1}).call(function(t){t.append("span").classed({"input-group-btn":1}).append("button").classed({btn:1,"btn-default":1,"btn-xs":1,attr_name:1}),t.append("span").classed({"input-group-addon":1,attr_ns:1}).append("i").classed({fa:1,"fa-fw":1}),t.append("input").classed({"form-control":1}).attr({type:"text"}).each(function(){Jupyter.keyboard_manager.register_events(this)}).on("change",function(t){var n=_nbpresentDeps.d3.select(this),i=parseFloat(n.property("value"));e.slide.set(["regions",t.region.key,t.attr.key],i)})}).on("mousedown",function(t){e.makeSlider(this,t)}),s.select(".attr_name").text(function(e){return-1===e.attr.key.indexOf(":")?e.attr.key:e.attr.key.split(":")[1]}),s.select(".attr_ns").each(function(e){var t=-1!==e.attr.key.indexOf(":"),n=_nbpresentDeps.d3.select(this).style({display:t?null:"none"});if(t){var i={treemap:"tree"}[e.attr.key.split(":")[0]];n.select(".fa").classed("fa-"+i,1)}}),s.select(".form-control").attr({value:function(e){return"boolean"==typeof e.attr.value?e.attr.value:"number"==typeof e.attr.value?e.attr.value.toFixed(3):void 0}})}}},{key:"makeSlider",value:function(e,t){var n=this,i=_nbpresentDeps.d3.mouse(e),r=_slicedToArray(i,2),a=r[0],s=(r[1],_nbpresentDeps.d3.select(e));s.on("mousemove",function(e){var t=_nbpresentDeps.d3.mouse(this),i=_slicedToArray(t,2),r=i[0],s=(i[1],(r-a)/20);a=r;var o=["regions",e.region.key,"attrs",e.attr.key];n.slide.set(o,n.slide.get(o)+s)}).on("mouseup",function(){s.on("mousemove",null)}).on("mouseexit",function(){s.on("mousemove",null)})}}]),e}();exports.RegionTree=RegionTree;

},{"./mini":7,"./toolbar":20,"nbpresent-deps":"nbpresent-deps"}],14:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sorter=void 0;var _nbpresentDeps=require("nbpresent-deps"),_namespace=require("base/js/namespace"),_namespace2=_interopRequireDefault(_namespace),_editor=require("./editor"),_toolbar=require("./toolbar"),_parts=require("./parts"),_mini=require("./mini"),_templates=require("./templates"),REMOVED="<removed>",Sorter=function(){function e(t,i){var s=this;_classCallCheck(this,e),this.tree=t,this.tour=i,this.templatePicked=this.templatePicked.bind(this),this.visible=this.tree.select(["sorting"]),this.visible.set(!1),this.slides=this.tree.select(["slides"]),this.selectedSlide=this.tree.select(["selectedSlide"]),this.selectedRegion=this.tree.select(["sorter","selectedRegion"]),this.selectedSlide.on("update",function(){return s.updateSelectedSlide()}),this.selectedRegion.on("update",function(){return s.updateSelectedRegion()}),this.slides.on("update",function(){return s.draw()}),this.visible.on("update",function(){return s.visibleUpdated()}),this.scale={x:_nbpresentDeps.d3.scale.linear()},this.mini=new _mini.MiniSlide(this.selectedRegion),this.drawn=!1}return _createClass(e,[{key:"visibleUpdated",value:function(){var e=this.visible.get();this.drawn||(this.initUI(),this.drawn=!0),e?this.draw():(this.editor&&(this.editor.destroy(),this.editor=null),this.templates&&(this.templates.destroy(),this.templates=null)),this.update()}},{key:"show",value:function(){this.visible.set(!this.visible.get())}},{key:"update",value:function(){var e=this.visible.get();this.$view.classed({offscreen:!e}).style({display:e?"block":"none"}),_nbpresentDeps.d3.select("#notebook").style({"margin-bottom":e?"100px":null})}},{key:"initUI",value:function(){var e=this;this.$view=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_sorter:1,offscreen:1}).style({display:"none"}),this.$slides=this.$view.append("div").classed({slides_wrap:1});var t=this.$view.append("h4").classed({nbpresent_brand:1}).append("a").attr({href:"https://continuumio.github.io/nbpresent/",target:"_blank"});t.append("i").attr("class","fa fa-fw fa-gift"),t.append("span").text("nbpresent"),this.$empty=this.$slides.append("h3").classed({empty:1}).text("No slides yet.");this.$view.append("div").classed({nbpresent_help:1}).append("a").attr({href:"#"}).on("click",function(){return e.tour.restart()}).append("i").attr("class","fa fa-question-circle");this.initToolbar(),this.initDrag()}},{key:"initDrag",value:function(){var e=this,t=void 0;this.drag=_nbpresentDeps.d3.behavior.drag().on("dragstart",function(e){var i=_nbpresentDeps.d3.select(this).classed({dragging:1});t=parseFloat(i.style("left"))}).on("drag",function(e){_nbpresentDeps.d3.select(this).style({left:(t+=_nbpresentDeps.d3.event.dx)+"px"})}).on("dragend",function(t,i){var s=_nbpresentDeps.d3.select(this).classed({dragging:0}),n=parseFloat(s.style("left")),l=e.tree.get("sortedSlides"),r=Math.floor(n/e.slideWidth()),a=void 0;a=n<e.slideWidth()||0>r?null:r>l.length||!l[r]?l.slice(-1)[0].key:l[r].key,t.key!==a?(e.unlinkSlide(t.key),e.selectedSlide.set(e.appendSlide(a,t.key))):e.draw()})}},{key:"slideHeight",value:function(){return 100}},{key:"slideWidth",value:function(){return 200}},{key:"copySlide",value:function(e){var t=this,i=JSON.parse(JSON.stringify(e));return i.id=this.nextId(),i.regions=_nbpresentDeps.d3.entries(i.regions).reduce(function(e,i){var s=t.nextId();return e[s]=$.extend(!0,{},i.value,{id:s,content:null}),e},{}),i}},{key:"slideClicked",value:function(e){if(this.templates){var t=this.copySlide(e.value);return this.templatePicked({key:t.id,value:t}),this.templates&&this.templates.destroy(),void(this.templates=null)}this.selectedSlide.set(e.key)}},{key:"draw",value:function(){var e=this;if(this.$slides){var t=this.tree.get("sortedSlides");this.scale.x.range([20,this.slideWidth()+20]);var i=this.$slides.selectAll(".slide").data(t,function(e){return e.key});i.enter().append("div").classed({slide:1}).call(this.drag).on("click",function(t){e.slideClicked(t)}).on("dblclick",function(t){return e.editSlide(t.key)}),i.exit().transition().style({top:"200px"}).remove();var s=this.selectedSlide.get(),n=this.selectedRegion.get(),l=void 0;i.style({"z-index":function(e,t){return t}}).classed({active:function(e){return e.key===s}}).transition().delay(function(e,t){return 10*t}).style({left:function r(t,i){var r=e.scale.x(i);return t.key===s&&(l=r),r+"px"}}),i.call(this.mini.update),this.$regionToolbar.transition().style({opacity:n?1:0,display:n?"block":"none",left:l-30+"px"}),this.$empty.transition().style({opacity:1*!i[0].length}).transition().style({display:i[0].length?"none":"block"}),this.$deckToolbar.call(this.deckToolbar.update)}}},{key:"updateSelectedRegion",value:function(){var e=this.selectedRegion.get()||{},t=e.slide,i=e.region;if(i){this.selectedSlide.set(t);var s=this.slides.get([t,"regions",i,"content"]);s&&this.selectCell(s.cell)}else this.$regionToolbar&&this.$regionToolbar.transition().style({opacity:0}).transition().style({display:"none"});this.draw()}},{key:"selectCell",value:function(e){_namespace2["default"].notebook.get_cells().filter(function(t,i){t.metadata.nbpresent&&t.metadata.nbpresent.id==e&&_namespace2["default"].notebook.select(i)})}},{key:"updateSelectedSlide",value:function(){var e=this.selectedSlide.get(),t=this.selectedRegion.get()||{};t.slide!=e&&this.selectedRegion.set(null),this.draw(),this.editor&&this.editSlide(e)}},{key:"initToolbar",value:function(){var e=this;this.deckToolbar=(new _toolbar.Toolbar).btnClass("btn-default btn-lg"),this.$deckToolbar=this.$view.append("div").classed({deck_toolbar:1}).datum([[{icon:"plus-square-o fa-2x",click:function(){return e.addSlide()},tip:"Add Slide"}],[{icon:"edit fa-2x",click:function(){return e.editSlide(e.selectedSlide.get())},tip:"Edit Slide",visible:function(){return e.selectedSlide.get()&&!e.editor}},{icon:"chevron-circle-down fa-2x",click:function(){return e.editSlide(e.selectedSlide.get())},tip:"Back to Sorter",visible:function(){return e.editor}}],[{icon:"trash fa-2x",click:function(){e.removeSlide(e.selectedSlide.get()),e.selectedSlide.set(null)},tip:"Delete Slide",visible:function(){return e.selectedSlide.get()}}]]).call(this.deckToolbar.update),this.regionToolbar=new _toolbar.Toolbar,this.$regionToolbar=this.$slides.append("div").classed({region_toolbar:1}).datum([[{icon:"terminal",click:function(){return e.linkContent(_parts.PART.source)},tip:"Link Region to Cell Input"},{icon:"image",click:function(){return e.linkContent(_parts.PART.outputs)},tip:"Link Region to Cell Output"},{icon:"sliders",click:function(){return e.linkContent(_parts.PART.widgets)},tip:"Link Region to Cell Widgets"},{icon:"unlink",click:function(){return e.linkContent(null)},tip:"Unlink Region"}]]).call(this.regionToolbar.update)}},{key:"linkContent",value:function(e){var t=this.selectedRegion.get()||{},i=t.slide,s=t.region,n=_namespace2["default"].notebook.get_selected_cell(),l=void 0;s&&n&&(e?(n.metadata.nbpresent||(n.metadata.nbpresent={id:this.nextId()}),l=n.metadata.nbpresent.id,this.slides.set([i,"regions",s,"content"],{cell:l,part:e})):this.slides.unset([i,"regions",s,"content"]))}},{key:"addSlide",value:function(){!this.templates||this.templates.killed?this.templates=new _templates.TemplateLibrary(this.templatePicked):(this.templates.destroy(),this.templates=null)}},{key:"templatePicked",value:function(e){if(e&&this.templates&&!this.templates.killed){var t=this.tree.get("sortedSlides").slice(-1),i=this.selectedSlide.get();this.slides.set([e.key],e.value);var s=this.appendSlide(i?i:t.length?t[0].key:null,e.key);this.selectedSlide.set(s)}this.templates&&(this.templates.destroy(),this.templates=null)}},{key:"editSlide",value:function(e){this.editor&&(this.editor.slide.get("id")===e&&(e=null),this.editor.destroy(),this.editor=null),e&&(this.editor=new _editor.Editor(this.slides.select(e),this.selectedRegion)),this.draw()}},{key:"nextId",value:function(){return _nbpresentDeps.uuid.v4()}},{key:"unlinkSlide",value:function(e){var t=this.slides.get(e),i=t.prev,s=this.nextSlide(e);s&&this.slides.set([s,"prev"],i),this.slides.set([e,"prev"],REMOVED)}},{key:"removeSlide",value:function(e){e&&(this.unlinkSlide(e),this.slides.unset(e))}},{key:"nextSlide",value:function(e){var t=this.tree.get("sortedSlides"),i=t.filter(function(t){return t.value.prev===e});return i.length?i[0].key:null}},{key:"newSlide",value:function(e,t){return{id:e,prev:t,regions:{}}}},{key:"appendSlide",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],i=this.nextSlide(e);return t?this.slides.set([t,"prev"],e):(t=this.nextId(),this.slides.set(t,this.newSlide(t,e))),i&&this.slides.set([i,"prev"],t),t}}]),e}();exports.Sorter=Sorter;

},{"./editor":4,"./mini":7,"./parts":10,"./templates":19,"./toolbar":20,"base/js/namespace":"base/js/namespace","nbpresent-deps":"nbpresent-deps"}],15:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpeakerBase=void 0;var _nbpresentDeps=require("nbpresent-deps"),_toolbar=require("../toolbar"),SpeakerBase=exports.SpeakerBase=function(){function e(t){var n=this;_classCallCheck(this,e),this.tree=t,this.current=this.tree.select(["selectedSlide"]),this.presenting=this.tree.select(["presenting"]),this.initUI(),this.presenting.on("update",function(){return n.update()}),this.update()}return _createClass(e,[{key:"initUI",value:function(){this.$ui=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_speaker:1}),this.initToolbar()}},{key:"update",value:function(){this.$ui.style({display:this.presenting.get()?null:"none"})}},{key:"toolbarIcons",value:function(){var e=this,t=this;return[[{icon:"fast-backward",click:function(){return t.current.set(e.tree.get(["sortedSlides",0,"key"]))},tip:"Back to Start"}],[{icon:"step-backward",click:function(){var n=t.tree.get(["slides",e.current.get()]);e.current.set(n.prev)},tip:"Previous Slide"}],[{icon:"step-forward",click:function(){return e.advance()},tip:"Next Slide"}]]}},{key:"advance",value:function(){var e=this,t=this.tree.get(["slides"]),n=t[this.current.get()];return _nbpresentDeps.d3.entries(t).map(function(t){t.value.prev===n.id&&e.current.set(t.key)}),this.current.get()}},{key:"initToolbar",value:function(){var e=new _toolbar.Toolbar;e.btnGroupClass("btn-group-vertical").btnClass("btn-link btn-lg").tipOptions({container:"body",placement:"top"}),this.$toolbar=this.$ui.append("div").classed({presenter_toolbar:1}).datum(this.toolbarIcons()).call(e.update)}}]),e}();

},{"../toolbar":20,"nbpresent-deps":"nbpresent-deps"}],16:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),_get=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.NotebookSpeaker=void 0;var _base=require("./base"),NotebookSpeaker=exports.NotebookSpeaker=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"toolbarIcons",value:function(){var e=this;return _get(Object.getPrototypeOf(t.prototype),"toolbarIcons",this).call(this).concat([[{icon:"book",click:function(){return e.presenting.set(!1)},tip:"Back to Notebook"}]])}}]),t}(_base.SpeakerBase);

},{"./base":15}],17:[function(require,module,exports){
"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var BaseStyle=exports.BaseStyle=function e(){_classCallCheck(this,e)};

},{}],18:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.SlabStyle=void 0;var _nbpresentDeps=require("nbpresent-deps"),_base=require("./base"),SlabStyle=exports.SlabStyle=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){this.slab=new _nbpresentDeps.VanillaSlab;var t="data-nbpresent-slab-id";if(!e.attr(t)){var r=_nbpresentDeps.uuid.v4();e.attr(t,r),this.slab.init({selector:'[data-nbpresent-slab-id="'+r+'"] h1'})}}}]),t}(_base.BaseStyle);

},{"./base":17,"nbpresent-deps":"nbpresent-deps"}],19:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.TemplateLibrary=void 0;var _nbpresentDeps=require("nbpresent-deps"),_mini=require("./mini"),_templates=[{regions:[{x:.1,y:.1,width:.8,height:.6},{x:.1,y:.7,width:.4,height:.2},{x:.5,y:.7,width:.4,height:.2}]},{regions:[{x:.1,y:.1,width:.8,height:.8}]},{regions:[{x:.1,y:.1,width:.2,height:.8},{x:.4,y:.1,width:.2,height:.8},{x:.7,y:.1,width:.2,height:.8}]},{regions:[{x:.1,y:.1,width:.4,height:.4},{x:.5,y:.1,width:.4,height:.4},{x:.1,y:.5,width:.4,height:.4},{x:.5,y:.5,width:.4,height:.4}]}],TemplateLibrary=function(){function e(t){_classCallCheck(this,e),this.picked=t,this.initUI(),this.mini=new _mini.MiniSlide,this.fakeSlide=this.fakeSlide.bind(this),this.update=this.update.bind(this),this.update()}return _createClass(e,[{key:"destroy",value:function(){this.$ui.transition().style({opacity:0}).remove(),this.killed=!0}},{key:"fakeSlide",value:function(e){var t=_nbpresentDeps.uuid.v4();return{key:t,value:{id:t,regions:e.regions.reduce(function(e,t){var i=_nbpresentDeps.uuid.v4();return e[i]=_nbpresentDeps.$.extend({},{id:i},{attrs:t}),e},{})}}}},{key:"initUI",value:function(){var e=this;this.$ui=_nbpresentDeps.d3.select("body").append("div").classed({nbpresent_template_library:1}),this.$ui.append("button").classed({btn:1,hide_library:1,"btn-default":1}).on("click",function(){return e.picked(null)}).append("i").classed({fa:1,"fa-remove":1}),this.$ui.append("h3").classed({from_template:1}).text("Pick template"),this.$ui.append("h3").classed({from_slide:1}).text("Reuse slide as template")}},{key:"update",value:function(){var e=this.$ui.selectAll(".slide").data(_templates.map(this.fakeSlide));e.enter().append("div").classed({slide:1}).call(this.mini.update),e.on("click",this.picked)}}]),e}();exports.TemplateLibrary=TemplateLibrary;

},{"./mini":7,"nbpresent-deps":"nbpresent-deps"}],20:[function(require,module,exports){
"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Toolbar=void 0;var _nbpresentDeps=require("nbpresent-deps"),fn=_nbpresentDeps.d3.functor,Toolbar=function(){function t(){_classCallCheck(this,t),this._btnClass=fn("btn-default"),this._btnGroupClass=fn("btn-group"),this._tipOptions=fn({container:"body"}),this.update=this.update.bind(this)}return _createClass(t,[{key:"btnClass",value:function(t){return arguments.length?[this._btnClass=fn(t),this][1]:this._btnClass}},{key:"tipOptions",value:function(t){return arguments.length?[this._tipOptions=fn(t),this][1]:this._tipOptions}},{key:"btnGroupClass",value:function(t){return arguments.length?[this._btnGroupClass=fn(t),this][1]:this._btnGroupClass}},{key:"update",value:function(t){var n=this,e=this;t.classed({"btn-toolbar":1,nbpresent_toolbar:1});var r=t.selectAll(".btn-toolbar-group").data(function(t){return t});r.enter().append("div").classed({"btn-toolbar-group":1}).classed(this._btnGroupClass(),1);var s=r.selectAll(".btn").data(function(t){return t},function(t){return t.tip});s.enter().append("a").attr("class",function(t){return"btn "+n._btnClass(t)}).attr({title:function(t){return t.tip}}).each(function(t){$.fn.tooltip&&$(this).tooltip(e._tipOptions(t))}).append("i"),s.on("click",function(t){return t.click()}).select("i").attr({"class":function(t){return"fa fa-fw fa-2x fa-"+t.icon}});var i=function(){$(this).tooltip("destroy")};s.filter(function(t){return t.visible&&!t.visible()}).each(i).remove(),s.exit().each(i).remove(),r.exit().remove()}}]),t}();exports.Toolbar=Toolbar;

},{"nbpresent-deps":"nbpresent-deps"}],21:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.NbpresentTour=void 0;var _bootstraptour=require("bootstraptour"),_bootstraptour2=_interopRequireDefault(_bootstraptour),_parts=require("./parts"),NbpresentTour=function(){function e(t){var n=this;_classCallCheck(this,e),this.nbpresent=t;var o=function(e,t){return d3.selectAll(e).classed({fake_hover:t})};this.tour=new _bootstraptour2["default"]({name:"nbpresent",reflex:!0,duration:5e3,orphan:!0,steps:[{element:"#nbpresent_sorter_btn",title:"Thanks for using nbpresent",placement:"bottom",content:"You just activated the nbpresent Sorter! Click Next to take the tour"},{element:"#nbpresent_sorter_btn",title:"Sorter",placement:"bottom",content:"You can add, reorder and remix your slides into a great presentation"},{element:"#nbpresent_present_btn",placement:"bottom",title:"Presenter",content:"With the Presenter, you can view that presentation, tweak the content in-place, and publish it to the world. But first..."},{element:".deck_toolbar .fa-plus-square-o",title:"Deck Toolbar",content:"Let's create a new slide",placement:"top",onNext:function(){return n.nbpresent.sorter.addSlide()}},{element:".from_template",title:"Template Library",position:"top",content:"You can pick from some existing templates..."},{element:".from_slide",title:"Reuse Slide as Template",position:"top",content:"Or copy an existing slide"},{element:".nbpresent_template_library .slide:nth-of-type(2)",title:"Simple Template",position:"top",content:"Let's use this one",onNext:function(){return n.nbpresent.sorter.templatePicked(d3.select(".nbpresent_template_library .slide:nth-of-type(2)").datum())}},{element:".slides_wrap .slide:last-child",placement:"top",title:"Look at the slide, just look at it",content:"Here's our new slide"},{element:".slides_wrap .slide:last-child .region",placement:"right",title:"Region",onShow:function(){var e=d3.select(".slides_wrap .slide:last-child .region");e.on("click")(e.datum())},content:"It has one Region"},{element:".region_toolbar .fa-external-link-square",placement:"top",title:"Cell Part",content:"You put a Part of a cell into a Region. The Parts are Inputs, like source code or Markdown..."},{element:".region_toolbar .fa-external-link",placement:"top",title:"Cell Part: Outputs",content:"... the Outputs, such as calculations, tables and figures..."},{element:".region_toolbar .fa-sliders",placement:"top",title:"Cell Part: Widgets",content:"...and interactive Widgets, including sliders and knobs."},{element:".region_toolbar .fa-unlink",placement:"top",title:"Cell Part: Unlinking",content:"Since a Part can be linked to more than one Region, you might need to Unlink one."},{element:".cell.selected",placement:"left",title:"Linking an Input Part",content:"Let's use this cell input"},{element:".slides_wrap .slide:last-child .region",placement:"top",title:"Part Thumbnail",content:"A part thumbnail might look a little funny, but you should usually be able to get an idea of what you're seeing.",onShow:function(){return n.nbpresent.sorter.linkContent(_parts.PART.source)}},{title:"Achievement Unlocked: Presentation",content:"We're ready to look at the presentation!"},{element:"#nbpresent_present_btn",title:"Great, let's have a look",placement:"bottom",content:"Clicking this button brings up the Presenter",onNext:function(){return n.nbpresent.present()}},{title:"Looks great!",content:"Your slide is still made up of your notebook"},{element:".nbpresent_present",placement:"top",title:"Most Notebook Editing Functionality",content:"This is still an editable input area"},{element:".nbpresent_present",placement:"bottom",title:"Part Execution",content:"Inputs can even be executed with keyboard shortcuts like ctrl+enter"},{element:".presenter_toolbar .fa-step-forward",title:"Go forward",content:"Click here to go to the next Slide",placement:"top",onShown:function(){return o(".presenter_toolbar",!0)},onHidden:function(){return o(".presenter_toolbar",0)}},{element:".presenter_toolbar .fa-step-backward",title:"Go back",content:"Clicking here to go back to the previous slide",placement:"top",onShown:function(){return o(".presenter_toolbar",!0)},onHidden:function(){return o(".presenter_toolbar",0)}},{element:".presenter_toolbar .fa-fast-backward",title:"Go back to the beginning",content:"Clicking here to go back to the first Slide",placement:"top",onShown:function(){return o(".presenter_toolbar",!0)},onHidden:function(){return o(".presenter_toolbar",0)}},{element:".presenter_toolbar .fa-book",title:"My work is done here",content:"Click here to go back to the Notebook",placement:"top",onShown:function(){return o(".presenter_toolbar",!0)},onHidden:function(){return o(".presenter_toolbar",0)&&n.nbpresent.unpresent()}},{element:".deck_toolbar .fa-edit",title:"Edit Slide",content:"If you need more control, you can edit a Slide's Regions directly",placement:"top",onHidden:function(){return n.nbpresent.sorter.editSlide(n.nbpresent.sorter.selectedSlide.get())}},{element:".nbpresent_editor .slide_bg",placement:"top",title:"Region Editor",content:"This is the Region editor. You can click and drag Regions around and resize them."},{element:".nbpresent_regiontree",placement:"right",title:"Region Tree",content:"This is the Region tree. It lets you reorder Regions and see the details of how your Regions will show their linked Parts."},{element:".region_attr .attr_name",placement:"right",title:"Attribute Editor",content:"All of the properties of a region can be edited here"},{element:".nbpresent_regiontree .btn-toolbar .fa-tree",placement:"right",title:"Magic Layouts",content:"In addition to manually moving regions around, you can use other Layouts, like this Treemap, which will fill the slide",onHidden:function(){n.nbpresent.sorter.editor.sidebar.layout("treemap")}},{element:".region_attr .fa-tree",placement:"right",title:"Treemagic",content:"This new value lets you make a Region bigger or smaller based on relative Weight"},{title:"FIN",content:"Thank you for using nbpresent!"}]})}return _createClass(e,[{key:"init",value:function(){return this.tour.init(),this}},{key:"start",value:function(){return this.tour.start(),this}},{key:"restart",value:function(){return this.tour.restart(),this}}]),e}();exports.NbpresentTour=NbpresentTour;

},{"./parts":10,"bootstraptour":"bootstraptour"}],22:[function(require,module,exports){
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tree=void 0;var _nbpresentDeps=require("nbpresent-deps"),Tree=exports.Tree=function(){function e(r){_classCallCheck(this,e),this.tree=new _nbpresentDeps.Baobab(_nbpresentDeps.$.extend({slides:{},presenter:{presenting:!1},sorter:{},editor:{},sortedSlides:_nbpresentDeps.Baobab.monkey(["slides"],this.sortedSlides)},r))}return _createClass(e,[{key:"sortedSlides",value:function(e){var r=_nbpresentDeps.d3.entries(e);return r.sort(function(e,r){return null===e.value.prev||e.key===r.value.prev?-1:1}),r}}]),e}();

},{"nbpresent-deps":"nbpresent-deps"}]},{},[9])(9)
});