(function(){!function($){$.fn.old_html=$.fn.html,$.fn.html=function(value){var ret,preTag,removePre=!1;return $.browser.msie&&void 0!==value&&this[0]&&/^(pre|textarea)$/i.test(this[0].tagName)&&(value="<pre>"+value+"</pre>",removePre=!0),ret=this.old_html.apply(this,void 0===value?[]:[value]),removePre&&(preTag=this.children(),preTag.replaceWith(preTag.contents())),ret}}(jQuery),function($){void 0===$.support.touch&&($.support.touch="ontouchstart"in window||navigator.msMaxTouchPoints),$.fn.extend({setVisible:function(visible){return $(this).each(function(){visible?$(this).show():$(this).hide()})},move:function(left,top,posType){return $(this).each(function(){$(this).css({left:left,top:top}),posType&&$(this).css("position",posType)})},scrollIntoView:function(){var $document=$(document),$window=$(window);return $(this).each(function(){var $this=$(this),offset=$this.offset(),scrollLeft=$document.scrollLeft(),scrollTop=$document.scrollTop(),elLeft=scrollLeft+$window.width()-(offset.left+$this.outerWidth(!0)),elTop=scrollTop+$window.height()-(offset.top+$this.outerHeight(!0));0>elLeft&&$window.scrollLeft(scrollLeft-elLeft),0>elTop&&$window.scrollTop(scrollTop-elTop)})}}),$.fn.getExtents=function(types,sides){var val=0;return this.each(function(){var type,side,prop,t,s,i,self=$(this);for(t=0;t<types.length;t++)for(type=types.charAt(t),s=0;s<sides.length;s++)side=sides.charAt(s),"b"===type?type="border":"m"===type?type="margin":"p"===type&&(type="padding"),"l"===side||"left"===side?side="Left":"r"===side||"right"===side?side="Right":"t"===side||"top"===side?side="Top":("b"===side||"bottom"===side)&&(side="Bottom"),prop=type+side,"border"===type&&(prop+="Width"),i=parseInt(self.css(prop),10),isNaN(i)||(val+=i)}),val},$.fn.positionToSide=function(el,options){var offset=$(el).offset(),thisWidth=this.outerWidth(),thisHeight=this.outerHeight(),elWidth=el.width(),elHeight=el.height(),scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop(),scrollWidth=$(window).width(),scrollHeight=$(window).height();return options=$.extend({side:"b",xDistance:options.distance||0,yDistance:options.distance||0,xOffset:0,yOffset:0,fitOnScreen:!1},options),$(this).each(function(){var side,left,top,i,bestLeft=null,bestTop=null;for(i=0;i<options.side.length;i++){if(side=options.side.charAt(i),left=null,top=null,"t"===side)top=offset.top-thisHeight-options.yDistance;else if("b"===side)top=offset.top+elHeight+options.yDistance;else if("l"===side)left=offset.left-thisWidth-options.xDistance;else{if("r"!==side)continue;left=offset.left+elWidth+options.xDistance}if(null!==left&&left>=scrollLeft&&scrollWidth>left+thisWidth-scrollLeft||null!==top&&top>=scrollTop&&scrollHeight>top+thisHeight-scrollTop){bestLeft=left,bestTop=top;break}null===bestLeft&&null===bestTop&&(bestLeft=left,bestTop=top)}null===bestLeft&&(bestLeft=offset.left+options.xOffset),null===bestTop&&(bestTop=offset.top+options.yOffset),options.fitOnScreen&&(bestLeft=Math.max(Math.min(bestLeft,scrollLeft+scrollWidth-thisWidth),scrollLeft),bestTop=Math.max(Math.min(bestTop,scrollTop+scrollHeight-thisHeight),scrollTop)),$(this).move(bestLeft,bestTop,"absolute")})},$.fn.delay=function(msec){return $(this).each(function(){var self=$(this);self.queue(function(){window.setTimeout(function(){self.dequeue()},msec)})})},$.fn.proxyTouchEvents=function(events){return events=events||"touchstart touchmove touchend",$(this).bind(events,function(event){var mouseEvent,touches=event.originalEvent.changedTouches,first=touches[0],type="";switch(event.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup"}mouseEvent=document.createEvent("MouseEvent"),mouseEvent.initMouseEvent(type,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(mouseEvent)||event.preventDefault()})},$.extend(String.prototype,{strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},htmlEncode:function(){return""===this?"":(str=this.replace(/&/g,"&amp;"),str=str.replace(/</g,"&lt;"),str=str.replace(/>/g,"&gt;"),str)},htmlDecode:function(){return""===this?"":(str=this.replace(/&amp;/g,"&"),str=str.replace(/&lt;/g,"<"),str=str.replace(/&gt;/g,">"),str)},truncate:function(numChars){numChars=numChars||100;var str=this.toString();return this.length>numChars&&(str=this.substring(0,numChars-3),i=str.lastIndexOf("."),-1!==i&&(str=str.substring(0,i+1)),str+="..."),str}})}(jQuery),function($){$.fn.retinaGravatar=function(){return window.devicePixelRatio>1&&$(this).each(function(){var params,param,baseurl,size,i,$el=$(this),src=$el.attr("src"),parts=src.split("?",2);if(2===parts.length){for(baseurl=parts[0],params=parts[1].split("&"),i=0;i<params.length;i++)param=params[i].split("=",2),2===param.length&&"s"===param[0]&&(size=parseInt(param[1],10),params[i]="s="+Math.floor(size*window.devicePixelRatio));$el.attr("src",baseurl+"?"+params.join("&")).removeClass("gravatar").addClass("gravatar-retina")}else console.log("Failed to parse URL for gravatar "+src)}),this}}(jQuery),function($){$.widget("ui.autoSizeTextArea",{options:{fadeSpeedMS:200,growOnKeyUp:!0,minHeight:100},_init:function(){var self=this;this._proxyEl=$("<pre/>").appendTo("body").move(-1e4,-1e4,"absolute"),this._proxyEl.css({"white-space":"pre-wrap","word-wrap":"break-word",font:this.element.css("font"),border:0,margin:0,padding:0}),this.element.css("overflow","hidden"),this.oldLength=this.element.val().length,this.options.growOnKeyUp&&this.element.keyup(function(){self.autoSize()})},destroy:function(){this._proxyEl.remove(),$.Widget.prototype.destroy.call(this)},autoSize:function(force,animate,animateFrom){var targetHeight,needsResize=!1,$el=this.element,el=$el[0],newLength=$el.val().length,newHeight=0,curHeight=$el.height(),normHeight=el.scrollHeight+(curHeight-el.clientHeight);normHeight!==curHeight?(needsResize=!0,newHeight=normHeight):(this.oldLength>newLength||force)&&(needsResize=!0,this._proxyEl.width($el.width()).move(-1e4,-1e4).text(this.element.val()+"\n"),newHeight=this._proxyEl.innerHeight()),needsResize&&(targetHeight=Math.max(this.options.minHeight-$el.getExtents("p","tb"),newHeight),animate?$el.height(animateFrom).animate({height:targetHeight},this.options.fadeSpeedMS).triggerHandler("resize"):$el.height(targetHeight).triggerHandler("resize")),this.oldLength=newLength},setMinHeight:function(minHeight){this.options.minHeight=minHeight,this.autoSize(!0)}})}(jQuery),function($){$.widget("ui.inlineEditor",{options:{cls:"",deferEventSetup:!1,editIconPath:null,editIconClass:null,enabled:!0,extraHeight:100,fadeSpeedMS:200,focusOnOpen:!0,forceOpen:!1,formatResult:null,hasRawValue:!1,matchHeight:!0,multiline:!1,notifyUnchangedCompletion:!1,promptOnCancel:!0,rawValue:null,showButtons:!0,showEditIcon:!0,startOpen:!1,stripTags:!1,useEditIconOnly:!1,createMultilineField:function(){return $("<textarea/>").autoSizeTextArea()},setFieldValue:function(editor,value){editor._field.val(value)},getFieldValue:function(editor){return editor._field.val()},isFieldDirty:function(editor,initialValue){var value=editor.options.getFieldValue(editor)||"",normValue=(editor.options.hasRawValue?value:value.htmlEncode())||"";return normValue.length!==initialValue.length||normValue!==initialValue}},_create:function(){var saveButton,cancelButton,isDragging,self=this;this._initialValue=null,this._editing=!1,this._dirty=!1,this._dirtyCalcScheduled=!1,this._form=$("<form/>").addClass("inline-editor-form "+this.options.cls).css("display","inline").insertBefore(this.element).hide(),this._field=this.options.multiline?this.options.createMultilineField(this).on("resize",_.bind(function(){this.element.triggerHandler("resize")},this)):$('<input type="text"/>'),this._isTextArea="TEXTAREA"===this._field[0].tagName,this.options.deferEventSetup||this.setupEvents(),this._buttons=null,this.options.showButtons&&(this._buttons=$(this.options.multiline?"<div/>":"<span/>"),this._buttons.addClass("buttons").appendTo(this._form),this._buttons.hide(),saveButton=$('<input type="button"/>').val(gettext("OK")).addClass("save").appendTo(this._buttons).click(function(){self.submit()}),cancelButton=$('<input type="button"/>').val(gettext("Cancel")).addClass("cancel").appendTo(this._buttons).click(function(){self.cancel()})),this._editIcon=null,this.options.showEditIcon&&(this._editIcon=$("<a/>").attr("href","#").attr("role","button").attr("aria-label",gettext("Edit this field")).addClass("editicon").click(function(){return self.startEdit(),!1}),this.options.editIconPath?this._editIcon.append('<img src="'+this.options.editIconPath+'"/>'):this.options.editIconClass&&this._editIcon.append('<div class="'+this.options.editIconClass+'"></div>'),this.options.showRequiredFlag&&this._editIcon.append($("<span/>").attr({"aria-label":gettext("This field is required"),title:gettext("This field is required")}).addClass("required-flag").text("*")),this.options.multiline?this._editIcon.appendTo($("label[for="+this.element[0].id+"]")):this._editIcon.insertAfter(this.element)),this.options.useEditIconOnly||(isDragging=!0,this.element.on("click","a",function(e){e.stopPropagation()}).click(function(){return isDragging||self.startEdit(),isDragging=!0,!1}).mousedown(function(){isDragging=!1,$(this).one("mousemove",function(){isDragging=!0})}).mouseup(function(){$(this).unbind("mousemove")})),$(window).resize(function(){self._fitWidthToParent()}),(this.options.forceOpen||this.options.startOpen)&&self.startEdit(!0),this.options.enabled?self.enable():self.disable()},setupEvents:function(){var self=this;this._field.prependTo(this._form).keydown(function(e){e.stopPropagation();var keyCode=e.keyCode?e.keyCode:e.charCode?e.charCode:e.which;switch(keyCode){case $.ui.keyCode.ENTER:self.options.forceOpen||self.options.multiline&&!e.ctrlKey||self.submit(),self.options.multiline||e.preventDefault();break;case $.ui.keyCode.ESCAPE:self.options.forceOpen||self.cancel();break;case 83:case 115:if(e.ctrlKey)return self.submit(),!1}}).keypress(function(e){e.stopPropagation()}).keyup(function(){return self._scheduleUpdateDirtyState(),!1})},enable:function(){this._editing&&this.showEditor(),this._editIcon&&this._editIcon.show(),this.options.enabled=!0},disable:function(){this._editing&&this.hideEditor(),this._editIcon&&this._editIcon.hide(),this.options.enabled=!1},startEdit:function(preventAnimation){var value;!this._editing&&this.options.enabled&&(this.options.hasRawValue?(this._initialValue=this.options.rawValue,value=this._initialValue):(this._initialValue=this.element.text(),value=this._normalizeText(this._initialValue).htmlDecode()),this._editing=!0,this.options.setFieldValue(this,value),this.element.triggerHandler("beginEditPreShow"),this.showEditor(preventAnimation),this.element.triggerHandler("beginEdit"))},save:function(){var value=this.value(),encodedValue=value.htmlEncode(),initialValue=this._initialValue;this._updateDirtyState(),this._dirty&&(this.element.html($.isFunction(this.options.formatResult)?this.options.formatResult(encodedValue):encodedValue),this._initialValue=this.element.text()),this._dirty||this.options.notifyUnchangedCompletion?(this.element.triggerHandler("complete",[value,initialValue]),this.options.hasRawValue&&(this.options.rawValue=value)):this.element.triggerHandler("cancel",[this._initialValue])},submit:function(){this.save(),this.hideEditor()},cancel:function(force){return!force&&this.options.promptOnCancel&&this.dirty()?void(confirm(gettext("You have unsaved changes. Are you sure you want to discard them?"))&&this.cancel(!0)):(this.hideEditor(),void this.element.triggerHandler("cancel",[this._initialValue]))},field:function(){return this._field},value:function(){return this.options.getFieldValue(this)},setValue:function(value){this.options.setFieldValue(this,value),this._updateDirtyState()},buttons:function(){return this._buttons},editing:function(){return this._editing},showEditor:function(preventAnimation){var elHeight,newHeight,self=this;this._editIcon&&(this.options.multiline&&!preventAnimation?this._editIcon.fadeOut(this.options.fadeSpeedMS):this._editIcon.hide()),this.element.hide(),this._form.show(),this.options.multiline?(elHeight=this.element.outerHeight(),newHeight=elHeight+this.options.extraHeight,this._fitWidthToParent(),this._isTextArea&&(this.options.matchHeight?(this._field.autoSizeTextArea("setMinHeight",newHeight).css("overflow","hidden"),preventAnimation?this._field.height(newHeight):this._field.height(elHeight).animate({height:newHeight},this.options.fadeSpeedMS)):this._field.autoSizeTextArea("autoSize",!0,!1,elHeight)),this._buttons&&this._buttons.show()):this._buttons&&this._buttons.show(),this._field.queue(function(){self.options.multiline&&self._isTextArea&&self._field.css("overflow","auto"),self._fitWidthToParent(),self.options.focusOnOpen&&self._field.focus(),self.options.multiline||self._field[0].select(),self._field.dequeue()})},hideEditor:function(){var self=this;self.options.forceOpen||(this._field.blur(),this._buttons&&this._buttons.hide(),this._editIcon&&(this.options.multiline?this._editIcon.fadeIn(this.options.fadeSpeedMS):this._editIcon.show()),this.options.multiline&&this.options.matchHeight&&this._editing&&this._isTextArea&&this._field.css("overflow","hidden").animate({height:this.element.outerHeight()},this.options.fadeSpeedMS),this._field.queue(function(){self.element.show(),self._form.hide(),self._field.dequeue()}),this._editing=!1,this._updateDirtyState())},dirty:function(){return this._dirtyCalcScheduled&&this._updateDirtyState(),this._dirty},_scheduleUpdateDirtyState:_.throttle(function(){this._dirtyCalcScheduled=!0,_.defer(this._updateDirtyState)},200),_updateDirtyState:function(){var curDirtyState=this._editing&&this.options.isFieldDirty(this,this._normalizeText(this._initialValue));this._dirty!==curDirtyState&&(this._dirty=curDirtyState,this.element.triggerHandler("dirtyStateChanged",[this._dirty])),this._dirtyCalcScheduled=!1},_fitWidthToParent:function(){var formParent,parentTextAlign,isLeftAligned,buttonsDisplay,boxSizing,extentTypes,buttonsWidth=0;this._editing&&(this.options.multiline?this._field.css({"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box",width:"100%"}):(formParent=this._form.parent(),parentTextAlign=formParent.css("text-align"),isLeftAligned="left"===parentTextAlign,isLeftAligned||formParent.css("text-align","left"),boxSizing=this._field.css("box-sizing"),extentTypes="border-box"===boxSizing?"m":"padding-box"===boxSizing?"p":"bmp",this._buttons&&(buttonsDisplay=this._buttons.css("display"),("inline"===buttonsDisplay||"inline-block"===buttonsDisplay)&&(buttonsWidth=this._buttons.outerWidth())),this._field.width(0).outerWidth(formParent.innerWidth()-(this._form.offset().left-formParent.offset().left)-this._field.getExtents(extentTypes,"lr")-buttonsWidth),isLeftAligned||formParent.css("text-align",parentTextAlign)))},_normalizeText:function(str){return this.options.stripTags&&(str=str.replace(/<br>/g,"\n"),str=str.stripTags().strip()),this.options.multiline||(str=str.replace(/\s{2,}/g," ")),str}}),$.ui.inlineEditor.getter="dirty field value",$.expr[":"].inlineEditorDirty=function(a){return $(a).inlineEditor("dirty")}}(jQuery),function($){$.widget("ui.modalBox",{options:{buttons:[$('<input type="button" />').val(gettext("Close"))],container:"body",discardOnClose:!0,fadeBackground:!0,modalBoxButtonsClass:"modalbox-buttons",modalBoxContentsClass:"modalbox-contents",modalBoxTitleClass:"modalbox-title",stretchX:!1,stretchY:!1,title:null},_init:function(){var self=this;this.options.fadeBackground&&(this.bgbox=$("<div/>").addClass("modalbox-bg").appendTo(this.options.container).css({"background-color":"#000",opacity:0}).move(0,0,"fixed").width("100%").height("100%").keydown(function(e){e.stopPropagation()})),this.box=$("<div/>").addClass("modalbox").move(0,0,"absolute").keydown(function(e){e.stopPropagation()}),this.options.boxID&&this.box.attr("id",this.options.boxID),this.inner=$("<div/>").appendTo(this.box).addClass("modalbox-inner").css({position:"relative",width:"100%",height:"100%"}),this.options.title&&(this.titleBox=$("<h1/>").appendTo(this.inner).addClass(this.options.modalBoxTitleClass).text(this.options.title)),this.element.appendTo(this.inner).addClass(this.options.modalBoxContentsClass).bind("DOMSubtreeModified",function(){self.resize()}),this._buttons=$("<div/>").appendTo(this.inner).addClass(this.options.modalBoxButtonsClass).click(function(e){"INPUT"!==e.target.tagName||e.target.disabled||self.element.modalBox("destroy")}),this.box.appendTo(this.options.container),$.each(this.options.buttons,function(){$(this).appendTo(self._buttons)}),this.options.fadeBackground&&this.bgbox.fadeTo(350,.85),$(window).bind("resize.modalbox",function(){self.resize()}),this.resize()},destroy:function(){var self=this;this.element.data("modalBox")&&(this.element.removeData("modalBox").unbind("resize.modalbox").css("position","static"),this.options.fadeBackground&&this.bgbox.fadeOut(350,function(){self.bgbox.remove()}),this.options.discardOnClose||this.element.appendTo(this.options.container),this.box.remove())},buttons:function(){return this._buttons},resize:function(){var marginHoriz=$("body").getExtents("m","lr"),marginVert=$("body").getExtents("m","tb"),winWidth=$(window).width()-marginHoriz,winHeight=$(window).height()-marginVert;this.options.stretchX&&this.box.width(winWidth-this.box.getExtents("bmp","lr")-marginHoriz),this.options.stretchY?(this.box.height(winHeight-this.box.getExtents("bmp","tb")-marginVert),this.element.height(this._buttons.position().top-this.element.position().top-this.element.getExtents("m","tb"))):this.box.height(this.element.position().top+this.element.outerHeight(!0)+this._buttons.outerHeight(!0)),this.box.move(Math.ceil((winWidth-this.box.outerWidth(!0))/2),Math.ceil((winHeight-this.box.outerHeight(!0))/2),"fixed"),this.element.triggerHandler("resize")}}),$.ui.modalBox.getter="buttons"}(jQuery),function($){$.tooltip=function($el,options){options=$.extend({side:"b"},options);var self=$("<div/>").addClass("tooltip").hide().appendTo("body");return $el.mouseenter(function(){self.children()&&self.positionToSide($el,{side:options.side,distance:10}).show()}).mouseleave(function(){self.hide()}),self}}(jQuery),function($){var queues={},queuesInProgress={};$.funcQueue=function(name){var self=this;return queues[name]||(queues[name]=[]),this.add=function(func,context){func&&queues[name].push([func,context])},this.next=function(){var info,func,context;queuesInProgress[name]&&(info=queues[name].shift(),info?(func=info[0],context=info[1],func.call(context)):queuesInProgress[name]=!1)},this.start=function(){!queuesInProgress[name]&&queues[name].length>0&&(queuesInProgress[name]=!0,self.next())},this.clear=function(){queues[name]=[],queuesInProgress[name]=!1},this}}(jQuery),$.fn.bindClass=function(model,modelPropName,className,options){function updateClassName(){var value=model.get(modelPropName);options&&options.inverse&&(value=!value),value?this.addClass(className):this.removeClass(className)}return model.on("change:"+modelPropName,updateClassName,this),updateClassName.call(this),this},$.fn.bindProperty=function(elPropName,model,modelPropName,options){function updateElementProp(){var value=model.get(modelPropName);void 0!==options.radioValue&&(value=options.radioValue===value),options.inverse&&(value=!value),"text"===elPropName||"html"===elPropName?$this[elPropName]()!==value&&$this[elPropName](void 0===value||null===value?"":value):$this.prop(elPropName)!==value&&$this.prop(elPropName,value)}var $this=this;return options=_.defaults(options||{},{modelToElement:!0,elementToModel:!0,inverse:!1,radioValue:void 0}),options.modelToElement&&(model.on("change:"+modelPropName,updateElementProp),updateElementProp()),options.elementToModel&&$this.on("change",function(){var value="text"===elPropName||"html"===elPropName?$this[elPropName]():$this.prop(elPropName);if(options.inverse&&(value=!value),void 0!==options.radioValue){if(!value)return;value=options.radioValue}model.set(modelPropName,value)}),$this},$.fn.bindVisibility=function(model,modelPropName,options){function updateVisibility(){var value=model.get(modelPropName);options&&options.inverse&&(value=!value),this.setVisible(value)}return model.on("change:"+modelPropName,updateVisibility,this),updateVisibility.call(this),this}}).call(this);