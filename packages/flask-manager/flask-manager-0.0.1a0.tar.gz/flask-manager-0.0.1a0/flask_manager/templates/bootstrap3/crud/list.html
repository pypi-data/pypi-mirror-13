{% extends "crud/base.html" %}

{# Macros #}
{% import 'crud/macros/utils.html' as Utils %}
{% import 'crud/macros/pagination.html' as Pagination %}
{% import 'crud/macros/roles.html' as Roles %}
{% import 'crud/macros/table.html' as Table %}
{% import 'crud/macros/data.html' as Data %}
{% import 'crud/macros/form.html' as Form %}

{# Local macros #}
{% macro render_filter_form(form, render) %}
  {% if render %}
    <div class="btn-group pull-right"><!-- Filters -->
      {% call Form.render_form(method='GET') %}

        {% if 'search' in form %}
          {# Search Field outside the dropdown menu #}
          {{ form.search() }}
        {% endif %}

        {% call Utils.dropmenu(name='Filter by', right=true) %}
          {{ Form.render_inline_fields(form, skip=['search']) }}
        {% endcall %}

      {% endcall %}
    </div><!-- Filters -->
  {% endif %}
{% endmacro %}

{% macro render_action_form(form, render) %}
  {% if render %}
    <div class="btn-group"><!-- Actions -->
      {% call Utils.dropmenu(name='With selected') %}
        {{ Form.render_inline_fields(form, skip=['ids']) }}
      {% endcall %}
    </div><!-- Actions -->
  {% endif %}
{% endmacro %}

{# Body #}
{% block content %}
  {{ render_filter_form(filter_form, show_filter_form) }}
  {{ Roles.buttons_create(roles) }}
  {% call Form.render_form(form=action_form) %}

    {{ render_action_form(action_form, show_action_form) }}
    {{ Pagination.render(page, pages, total, url_generator) }}

    {% call Table.render_table(rules.columns, url_generator=url_generator, current=order_by) %}
      {% for item in items %}
        {{ rules(item, roles=roles) }}
      {% endfor %}
    {% endcall %}
  {% endcall %}
{% endblock %}
