{% macro menu_tree(tree) %}
  {% set name, endpoint, subtree = tree %} {# first node is root alone #}
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed"
                              data-toggle="collapse"
                              data-target="#navbar"
                              aria-expanded="false"
                              aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        {% if endpoint is not none %}
          <a class="navbar-brand" href="{{ url_for(endpoint) }}">{{ name }}</a>
        {% else %}
          <a class="navbar-brand" href="#">{{ name }}</a>
        {% endif %}
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          {% for name, endpoint, childrens in subtree %}
            <li class="dropdown">
              {{ _menu_item(name, endpoint, childrens) }}
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </nav>
{% endmacro %}

{% macro _menu_item(name, endpoint, childrens) %}
  {% if endpoint is not none %}
    {% set url = url_for(endpoint) %}
  {% else %}
    {% set url = '#' %}
  {% endif %}
  {% if not childrens %}
    <a href="{{ url }}">{{ name }}</a>
  {% else %}
    <a href="{{ url }}" class="dropdown-toggle"
                                      role="button"
                                      data-toggle="dropdown"
                                      aria-haspopup="true"
                                      aria-expanded="false">
      {{ name }}
      <span class="caret"></span>
    </a>
    {{ _submenu_tree(childrens) }}
  {% endif %}
{% endmacro %}

{% macro _submenu_tree(tree) %}
  {% if tree %}
    <ul class="dropdown-menu">
      {% for name, endpoint, childrens in tree %}
        {% if endpoint is not none %}
          {% set url = url_for(endpoint) %}
        {% else %}
          {% set url = '#' %}
        {% endif %}
        {% if childrens %}
          {% set class = 'dropdown-submenu' %}
        {% endif %}
        <li class="{{ class }}">
          <a href="{{ url }}">{{ name }}</a>
          {{ _submenu_tree(childrens) }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
