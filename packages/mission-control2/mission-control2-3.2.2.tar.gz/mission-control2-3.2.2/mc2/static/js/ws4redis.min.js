function WS4Redis(a,b){"use strict";function j(a){try{console.log("Connecting to "+a+" ..."),e=b.Deferred(),d=new WebSocket(a),d.onopen=l,d.onmessage=o,d.onerror=n,d.onclose=m,f=null}catch(c){e.reject(new Error(c))}}function k(){try{if(i++,i>3)throw new Error("Too many missed heartbeats.");d.send(c.heartbeat_msg)}catch(a){clearInterval(h),h=null,console.warn("Closing connection. Reason: "+a.message),d.close()}}function l(){console.log("Connected!"),g=1,e.resolve(),c.heartbeat_msg&&null===h&&(i=0,h=setInterval(k,5e3))}function m(){if(console.log("Connection closed!"),!f){var b=p(g);f=setTimeout(function(){g++,j(d.url)},b)}}function n(a){console.error("Websocket connection is broken!"),e.reject(new Error(a))}function o(a){if(c.heartbeat_msg&&a.data===c.heartbeat_msg)i=0;else if("function"==typeof c.receive_message)return c.receive_message(a.data)}function p(a){var b=1e3*(Math.pow(2,a)-1);return b>3e4&&(b=3e4),Math.random()*b}var c,d,e,f,g=1,h=null,i=0;if(void 0===this)return new WS4Redis(a,b);if(void 0===a.uri)throw new Error("No Websocket URI in options");void 0===b&&(b=jQuery),c=b.extend({heartbeat_msg:null},a),j(c.uri),this.send_message=function(a){d.send(a)}}
