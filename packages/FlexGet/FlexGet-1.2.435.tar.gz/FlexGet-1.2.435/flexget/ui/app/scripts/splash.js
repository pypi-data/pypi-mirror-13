/**
* please-wait
* Display a nice loading screen while your app loads

* @author Pathgather <tech@pathgather.com>
* @copyright Pathgather 2015
* @license MIT <http://opensource.org/licenses/mit-license.php>
* @link https://github.com/Pathgather/please-wait
* @module please-wait
* @version 0.0.5
*/
!function(n,i){"object"==typeof exports?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(n)}(this,function(n){var i,t,o,l,e,a,s,d,r,m,g,h,u,c,p,_;a=document.createElement("fakeelement"),l=!1,u=!1,o="animationend",h=null,e="Webkit Moz O ms".split(" "),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};for(s in g)if(c=g[s],null!=a.style[s]){h=c,u=!0;break}if(null!=a.style.animationName&&(l=!0),!l)for(p=0,_=e.length;_>p;p++)if(d=e[p],null!=a.style[""+d+"AnimationName"]){switch(d){case"Webkit":o="webkitAnimationEnd";break;case"Moz":o="animationend";break;case"O":o="oanimationend";break;case"ms":o="MSAnimationEnd"}l=!0;break}return t=function(n,i){return i.classList?i.classList.add(n):i.className+=" "+n},m=function(n,i){return i.classList?i.classList.remove(n):i.className=i.className.replace(n,"").trim()},i=function(){function n(n){var i,e,a,s;i=this.constructor._defaultOptions,this.options={},this.loaded=!1,this.finishing=!1;for(e in i)s=i[e],this.options[e]=null!=n[e]?n[e]:s;this._loadingElem=document.createElement("div"),this._loadingHtmlToDisplay=[],this._loadingElem.className="pg-loading-screen",null!=this.options.backgroundColor&&(this._loadingElem.style.backgroundColor=this.options.backgroundColor),this._loadingElem.innerHTML=this.options.template,this._loadingHtmlElem=this._loadingElem.getElementsByClassName("pg-loading-html")[0],null!=this._loadingHtmlElem&&(this._loadingHtmlElem.innerHTML=this.options.loadingHtml),this._readyToShowLoadingHtml=!1,this._logoElem=this._loadingElem.getElementsByClassName("pg-loading-logo")[0],null!=this._logoElem&&(this._logoElem.src=this.options.logo),m("pg-loaded",document.body),t("pg-loading",document.body),document.body.appendChild(this._loadingElem),t("pg-loading",this._loadingElem),this._onLoadedCallback=this.options.onLoadedCallback,a=function(n){return function(i){return n.loaded=!0,n._readyToShowLoadingHtml=!0,t("pg-loaded",n._loadingHtmlElem),l&&n._loadingHtmlElem.removeEventListener(o,a),n._loadingHtmlToDisplay.length>0&&n._changeLoadingHtml(),n.finishing?(null!=i&&i.stopPropagation(),n._finish()):void 0}}(this),null!=this._loadingHtmlElem&&(l?this._loadingHtmlElem.addEventListener(o,a):a(),this._loadingHtmlListener=function(n){return function(){return n._readyToShowLoadingHtml=!0,m("pg-loading",n._loadingHtmlElem),u&&n._loadingHtmlElem.removeEventListener(h,n._loadingHtmlListener),n._loadingHtmlToDisplay.length>0?n._changeLoadingHtml():void 0}}(this),this._removingHtmlListener=function(n){return function(){return n._loadingHtmlElem.innerHTML=n._loadingHtmlToDisplay.shift(),m("pg-removing",n._loadingHtmlElem),t("pg-loading",n._loadingHtmlElem),u?(n._loadingHtmlElem.removeEventListener(h,n._removingHtmlListener),n._loadingHtmlElem.addEventListener(h,n._loadingHtmlListener)):n._loadingHtmlListener()}}(this))}return n._defaultOptions={backgroundColor:null,logo:null,loadingHtml:null,template:"<div class='pg-loading-inner'>\n  <div class='pg-loading-center-outer'>\n    <div class='pg-loading-center-middle'>\n      <h1 class='pg-loading-logo-header'>\n        <img class='pg-loading-logo'></img>\n      </h1>\n      <div class='pg-loading-html'>\n      </div>\n    </div>\n  </div>\n</div>",onLoadedCallback:null},n.prototype.finish=function(n,i){return null==n&&(n=!1),window.document.hidden&&(n=!0),this.finishing=!0,null!=i&&this.updateOption("onLoadedCallback",i),this.loaded||n?this._finish(n):void 0},n.prototype.updateOption=function(n,i){switch(n){case"backgroundColor":return this._loadingElem.style.backgroundColor=i;case"logo":return this._logoElem.src=i;case"loadingHtml":return this.updateLoadingHtml(i);case"onLoadedCallback":return this._onLoadedCallback=i;default:throw new Error("Unknown option '"+n+"'")}},n.prototype.updateOptions=function(n){var i,t,o;null==n&&(n={}),o=[];for(i in n)t=n[i],o.push(this.updateOption(i,t));return o},n.prototype.updateLoadingHtml=function(n,i){if(null==i&&(i=!1),null==this._loadingHtmlElem)throw new Error("The loading template does not have an element of class 'pg-loading-html'");return i?(this._loadingHtmlToDisplay=[n],this._readyToShowLoadingHtml=!0):this._loadingHtmlToDisplay.push(n),this._readyToShowLoadingHtml?this._changeLoadingHtml():void 0},n.prototype._changeLoadingHtml=function(){return this._readyToShowLoadingHtml=!1,this._loadingHtmlElem.removeEventListener(h,this._loadingHtmlListener),this._loadingHtmlElem.removeEventListener(h,this._removingHtmlListener),m("pg-loading",this._loadingHtmlElem),m("pg-removing",this._loadingHtmlElem),u?(t("pg-removing",this._loadingHtmlElem),this._loadingHtmlElem.addEventListener(h,this._removingHtmlListener)):this._removingHtmlListener()},n.prototype._finish=function(n){var i;return null==n&&(n=!1),null!=this._loadingElem?(t("pg-loaded",document.body),"function"==typeof this._onLoadedCallback&&this._onLoadedCallback.apply(this),i=function(n){return function(){return document.body.removeChild(n._loadingElem),m("pg-loading",document.body),l&&n._loadingElem.removeEventListener(o,i),n._loadingElem=null}}(this),!n&&l?(t("pg-loaded",this._loadingElem),this._loadingElem.addEventListener(o,i)):i()):void 0},n}(),r=function(n){return null==n&&(n={}),new i(n)},n.pleaseWait=r,r});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvc3BsYXNoLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsImRlZmluZSIsImFtZCIsInRoaXMiLCJQbGVhc2VXYWl0IiwiYWRkQ2xhc3MiLCJhbmltYXRpb25FdmVudCIsImFuaW1hdGlvblN1cHBvcnQiLCJkb21QcmVmaXhlcyIsImVsbSIsImtleSIsInBmeCIsInBsZWFzZVdhaXQiLCJyZW1vdmVDbGFzcyIsInRyYW5zRW5kRXZlbnROYW1lcyIsInRyYW5zaXRpb25FdmVudCIsInRyYW5zaXRpb25TdXBwb3J0IiwidmFsIiwiX2kiLCJfbGVuIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3BsaXQiLCJXZWJraXRUcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwibXNUcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsInN0eWxlIiwiYW5pbWF0aW9uTmFtZSIsImxlbmd0aCIsImNsYXNzbmFtZSIsImVsZW0iLCJjbGFzc0xpc3QiLCJhZGQiLCJjbGFzc05hbWUiLCJyZW1vdmUiLCJyZXBsYWNlIiwidHJpbSIsIm9wdGlvbnMiLCJkZWZhdWx0T3B0aW9ucyIsImsiLCJsaXN0ZW5lciIsInYiLCJjb25zdHJ1Y3RvciIsIl9kZWZhdWx0T3B0aW9ucyIsImxvYWRlZCIsImZpbmlzaGluZyIsIl9sb2FkaW5nRWxlbSIsIl9sb2FkaW5nSHRtbFRvRGlzcGxheSIsImJhY2tncm91bmRDb2xvciIsImlubmVySFRNTCIsInRlbXBsYXRlIiwiX2xvYWRpbmdIdG1sRWxlbSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJsb2FkaW5nSHRtbCIsIl9yZWFkeVRvU2hvd0xvYWRpbmdIdG1sIiwiX2xvZ29FbGVtIiwic3JjIiwibG9nbyIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIl9vbkxvYWRlZENhbGxiYWNrIiwib25Mb2FkZWRDYWxsYmFjayIsIl90aGlzIiwiZXZ0IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIl9jaGFuZ2VMb2FkaW5nSHRtbCIsInN0b3BQcm9wYWdhdGlvbiIsIl9maW5pc2giLCJhZGRFdmVudExpc3RlbmVyIiwiX2xvYWRpbmdIdG1sTGlzdGVuZXIiLCJfcmVtb3ZpbmdIdG1sTGlzdGVuZXIiLCJzaGlmdCIsInByb3RvdHlwZSIsImZpbmlzaCIsImltbWVkaWF0ZWx5Iiwid2luZG93IiwiaGlkZGVuIiwidXBkYXRlT3B0aW9uIiwib3B0aW9uIiwidmFsdWUiLCJ1cGRhdGVMb2FkaW5nSHRtbCIsIkVycm9yIiwidXBkYXRlT3B0aW9ucyIsIl9yZXN1bHRzIiwicHVzaCIsImFwcGx5IiwicmVtb3ZlQ2hpbGQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0NBV0EsU0FBVUEsRUFBTUMsR0FDUyxnQkFBWkMsU0FDVEQsRUFBUUMsU0FDbUIsa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUNoREQsUUFBUSxXQUFZRixHQUVwQkEsRUFBUUQsSUFFVEssS0FBTSxTQUFTSCxHQUNoQixHQUFJSSxHQUFZQyxFQUFVQyxFQUFnQkMsRUFBa0JDLEVBQWFDLEVBQUtDLEVBQUtDLEVBQUtDLEVBQVlDLEVBQWFDLEVBQW9CQyxFQUFpQkMsRUFBbUJDLEVBQUtDLEVBQUlDLENBQ2xMVixHQUFNVyxTQUFTQyxjQUFjLGVBQzdCZCxHQUFtQixFQUNuQlMsR0FBb0IsRUFDcEJWLEVBQWlCLGVBQ2pCUyxFQUFrQixLQUNsQlAsRUFBYyxrQkFBa0JjLE1BQU0sS0FDdENSLEdBQ0VTLGlCQUFvQixzQkFDcEJDLGNBQWlCLGdCQUNqQkMsWUFBZSxpQkFDZkMsYUFBZ0Isa0JBQ2hCQyxXQUFjLGdCQUVoQixLQUFLakIsSUFBT0ksR0FFVixHQURBRyxFQUFNSCxFQUFtQkosR0FDSCxNQUFsQkQsRUFBSW1CLE1BQU1sQixHQUFjLENBQzFCSyxFQUFrQkUsRUFDbEJELEdBQW9CLENBQ3BCLE9BTUosR0FIK0IsTUFBM0JQLEVBQUltQixNQUFNQyxnQkFDWnRCLEdBQW1CLElBRWhCQSxFQUNILElBQUtXLEVBQUssRUFBR0MsRUFB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L0JyRCxHQUNGeUQsRUFBTWhCLGFBQWFrQixvQkFBb0I1RCxFQUFnQm9DLEdBRWxEc0IsRUFBTWhCLGFBQWUsT0FFN0I3QyxPQUNFeUUsR0FBZXJFLEdBQ2xCRixFQUFTLFlBQWFGLEtBQUs2QyxjQUNwQjdDLEtBQUs2QyxhQUFhc0IsaUJBQWlCaEUsRUFBZ0JvQyxJQUVuREEsS0FyQlQsUUF5Qkt0QyxLQUdUUSxFQUFhLFNBQVMyQixHQUlwQixNQUhlLE9BQVhBLElBQ0ZBLE1BRUssR0FBSW5DLEdBQVdtQyxJQUV4QnZDLEVBQVFZLFdBQWFBLEVBQ2RBIiwiZmlsZSI6InNjcmlwdHMvc3BsYXNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4qIHBsZWFzZS13YWl0XG4qIERpc3BsYXkgYSBuaWNlIGxvYWRpbmcgc2NyZWVuIHdoaWxlIHlvdXIgYXBwIGxvYWRzXG5cbiogQGF1dGhvciBQYXRoZ2F0aGVyIDx0ZWNoQHBhdGhnYXRoZXIuY29tPlxuKiBAY29weXJpZ2h0IFBhdGhnYXRoZXIgMjAxNVxuKiBAbGljZW5zZSBNSVQgPGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHA+XG4qIEBsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXRoZ2F0aGVyL3BsZWFzZS13YWl0XG4qIEBtb2R1bGUgcGxlYXNlLXdhaXRcbiogQHZlcnNpb24gMC4wLjVcbiovXG4oZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09IFwib2JqZWN0XCIpIHtcbiAgICBmYWN0b3J5KGV4cG9ydHMpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcImV4cG9ydHNcIl0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIGZhY3Rvcnkocm9vdCk7XG4gIH1cbn0pKHRoaXMsIGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiAgdmFyIFBsZWFzZVdhaXQsIGFkZENsYXNzLCBhbmltYXRpb25FdmVudCwgYW5pbWF0aW9uU3VwcG9ydCwgZG9tUHJlZml4ZXMsIGVsbSwga2V5LCBwZngsIHBsZWFzZVdhaXQsIHJlbW92ZUNsYXNzLCB0cmFuc0VuZEV2ZW50TmFtZXMsIHRyYW5zaXRpb25FdmVudCwgdHJhbnNpdGlvblN1cHBvcnQsIHZhbCwgX2ksIF9sZW47XG4gIGVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zha2VlbGVtZW50Jyk7XG4gIGFuaW1hdGlvblN1cHBvcnQgPSBmYWxzZTtcbiAgdHJhbnNpdGlvblN1cHBvcnQgPSBmYWxzZTtcbiAgYW5pbWF0aW9uRXZlbnQgPSAnYW5pbWF0aW9uZW5kJztcbiAgdHJhbnNpdGlvbkV2ZW50ID0gbnVsbDtcbiAgZG9tUHJlZml4ZXMgPSAnV2Via2l0IE1veiBPIG1zJy5zcGxpdCgnICcpO1xuICB0cmFuc0VuZEV2ZW50TmFtZXMgPSB7XG4gICAgJ1dlYmtpdFRyYW5zaXRpb24nOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgJ01velRyYW5zaXRpb24nOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgJ09UcmFuc2l0aW9uJzogJ29UcmFuc2l0aW9uRW5kJyxcbiAgICAnbXNUcmFuc2l0aW9uJzogJ01TVHJhbnNpdGlvbkVuZCcsXG4gICAgJ3RyYW5zaXRpb24nOiAndHJhbnNpdGlvbmVuZCdcbiAgfTtcbiAgZm9yIChrZXkgaW4gdHJhbnNFbmRFdmVudE5hbWVzKSB7XG4gICAgdmFsID0gdHJhbnNFbmRFdmVudE5hbWVzW2tleV07XG4gICAgaWYgKGVsbS5zdHlsZVtrZXldICE9IG51bGwpIHtcbiAgICAgIHRyYW5zaXRpb25FdmVudCA9IHZhbDtcbiAgICAgIHRyYW5zaXRpb25TdXBwb3J0ID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBpZiAoZWxtLnN0eWxlLmFuaW1hdGlvbk5hbWUgIT0gbnVsbCkge1xuICAgIGFuaW1hdGlvblN1cHBvcnQgPSB0cnVlO1xuICB9XG4gIGlmICghYW5pbWF0aW9uU3VwcG9ydCkge1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZG9tUHJlZml4ZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgIHBmeCA9IGRvbVByZWZpeGVzW19pXTtcbiAgICAgIGlmIChlbG0uc3R5bGVbXCJcIiArIHBmeCArIFwiQW5pbWF0aW9uTmFtZVwiXSAhPSBudWxsKSB7XG4gICAgICAgIHN3aXRjaCAocGZ4KSB7XG4gICAgICAgICAgY2FzZSAnV2Via2l0JzpcbiAgICAgICAgICAgIGFuaW1hdGlvbkV2ZW50ID0gJ3dlYmtpdEFuaW1hdGlvbkVuZCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdNb3onOlxuICAgICAgICAgICAgYW5pbWF0aW9uRXZlbnQgPSAnYW5pbWF0aW9uZW5kJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ08nOlxuICAgICAgICAgICAgYW5pbWF0aW9uRXZlbnQgPSAnb2FuaW1hdGlvbmVuZCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdtcyc6XG4gICAgICAgICAgICBhbmltYXRpb25FdmVudCA9ICdNU0FuaW1hdGlvbkVuZCc7XG4gICAgICAgIH1cbiAgICAgICAgYW5pbWF0aW9uU3VwcG9ydCA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBhZGRDbGFzcyA9IGZ1bmN0aW9uKGNsYXNzbmFtZSwgZWxlbSkge1xuICAgIGlmIChlbGVtLmNsYXNzTGlzdCkge1xuICAgICAgcmV0dXJuIGVsZW0uY2xhc3NMaXN0LmFkZChjbGFzc25hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZWxlbS5jbGFzc05hbWUgKz0gXCIgXCIgKyBjbGFzc25hbWU7XG4gICAgfVxuICB9O1xuICByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGNsYXNzbmFtZSwgZWxlbSkge1xuICAgIGlmIChlbGVtLmNsYXNzTGlzdCkge1xuICAgICAgcmV0dXJuIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc25hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZWxlbS5jbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZS5yZXBsYWNlKGNsYXNzbmFtZSwgXCJcIikudHJpbSgpO1xuICAgIH1cbiAgfTtcbiAgUGxlYXNlV2FpdCA9IChmdW5jdGlvbigpIHtcbiAgICBQbGVhc2VXYWl0Ll9kZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogbnVsbCxcbiAgICAgIGxvZ286IG51bGwsXG4gICAgICBsb2FkaW5nSHRtbDogbnVsbCxcbiAgICAgIHRlbXBsYXRlOiBcIjxkaXYgY2xhc3M9J3BnLWxvYWRpbmctaW5uZXInPlxcbiAgPGRpdiBjbGFzcz0ncGctbG9hZGluZy1jZW50ZXItb3V0ZXInPlxcbiAgICA8ZGl2IGNsYXNzPSdwZy1sb2FkaW5nLWNlbnRlci1taWRkbGUnPlxcbiAgICAgIDxoMSBjbGFzcz0ncGctbG9hZGluZy1sb2dvLWhlYWRlcic+XFxuICAgICAgICA8aW1nIGNsYXNzPSdwZy1sb2FkaW5nLWxvZ28nPjwvaW1nPlxcbiAgICAgIDwvaDE+XFxuICAgICAgPGRpdiBjbGFzcz0ncGctbG9hZGluZy1odG1sJz5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9kaXY+XFxuICA8L2Rpdj5cXG48L2Rpdj5cIixcbiAgICAgIG9uTG9hZGVkQ2FsbGJhY2s6IG51bGxcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGxlYXNlV2FpdChvcHRpb25zKSB7XG4gICAgICB2YXIgZGVmYXVsdE9wdGlvbnMsIGssIGxpc3RlbmVyLCB2O1xuICAgICAgZGVmYXVsdE9wdGlvbnMgPSB0aGlzLmNvbnN0cnVjdG9yLl9kZWZhdWx0T3B0aW9ucztcbiAgICAgIHRoaXMub3B0aW9ucyA9IHt9O1xuICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuZmluaXNoaW5nID0gZmFsc2U7XG4gICAgICBmb3IgKGsgaW4gZGVmYXVsdE9wdGlvbnMpIHtcbiAgICAgICAgdiA9IGRlZmF1bHRPcHRpb25zW2tdO1xuICAgICAgICB0aGlzLm9wdGlvbnNba10gPSBvcHRpb25zW2tdICE9IG51bGwgPyBvcHRpb25zW2tdIDogdjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2xvYWRpbmdFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRoaXMuX2xvYWRpbmdIdG1sVG9EaXNwbGF5ID0gW107XG4gICAgICB0aGlzLl9sb2FkaW5nRWxlbS5jbGFzc05hbWUgPSBcInBnLWxvYWRpbmctc2NyZWVuXCI7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmJhY2tncm91bmRDb2xvciAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuX2xvYWRpbmdFbGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICB9XG4gICAgICB0aGlzLl9sb2FkaW5nRWxlbS5pbm5lckhUTUwgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGU7XG4gICAgICB0aGlzLl9sb2FkaW5nSHRtbEVsZW0gPSB0aGlzLl9sb2FkaW5nRWxlbS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicGctbG9hZGluZy1odG1sXCIpWzBdO1xuICAgICAgaWYgKHRoaXMuX2xvYWRpbmdIdG1sRWxlbSAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuX2xvYWRpbmdIdG1sRWxlbS5pbm5lckhUTUwgPSB0aGlzLm9wdGlvbnMubG9hZGluZ0h0bWw7XG4gICAgICB9XG4gICAgICB0aGlzLl9yZWFkeVRvU2hvd0xvYWRpbmdIdG1sID0gZmFsc2U7XG4gICAgICB0aGlzLl9sb2dvRWxlbSA9IHRoaXMuX2xvYWRpbmdFbGVtLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJwZy1sb2FkaW5nLWxvZ29cIilbMF07XG4gICAgICBpZiAodGhpcy5fbG9nb0VsZW0gIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9sb2dvRWxlbS5zcmMgPSB0aGlzLm9wdGlvbnMubG9nbztcbiAgICAgIH1cbiAgICAgIHJlbW92ZUNsYXNzKFwicGctbG9hZGVkXCIsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgYWRkQ2xhc3MoXCJwZy1sb2FkaW5nXCIsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLl9sb2FkaW5nRWxlbSk7XG4gICAgICBhZGRDbGFzcyhcInBnLWxvYWRpbmdcIiwgdGhpcy5fbG9hZGluZ0VsZW0pO1xuICAgICAgdGhpcy5fb25Mb2FkZWRDYWxsYmFjayA9IHRoaXMub3B0aW9ucy5vbkxvYWRlZENhbGxiYWNrO1xuICAgICAgbGlzdGVuZXIgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgIF90aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgX3RoaXMuX3JlYWR5VG9TaG93TG9hZGluZ0h0bWwgPSB0cnVlO1xuICAgICAgICAgIGFkZENsYXNzKFwicGctbG9hZGVkXCIsIF90aGlzLl9sb2FkaW5nSHRtbEVsZW0pO1xuICAgICAgICAgIGlmIChhbmltYXRpb25TdXBwb3J0KSB7XG4gICAgICAgICAgICBfdGhpcy5fbG9hZGluZ0h0bWxFbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoYW5pbWF0aW9uRXZlbnQsIGxpc3RlbmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKF90aGlzLl9sb2FkaW5nSHRtbFRvRGlzcGxheS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBfdGhpcy5fY2hhbmdlTG9hZGluZ0h0bWwoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKF90aGlzLmZpbmlzaGluZykge1xuICAgICAgICAgICAgaWYgKGV2dCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5fZmluaXNoKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICBpZiAodGhpcy5fbG9hZGluZ0h0bWxFbGVtICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGFuaW1hdGlvblN1cHBvcnQpIHtcbiAgICAgICAgICB0aGlzLl9sb2FkaW5nSHRtbEVsZW0uYWRkRXZlbnRMaXN0ZW5lcihhbmltYXRpb25FdmVudCwgbGlzdGVuZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxpc3RlbmVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbG9hZGluZ0h0bWxMaXN0ZW5lciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF90aGlzLl9yZWFkeVRvU2hvd0xvYWRpbmdIdG1sID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlbW92ZUNsYXNzKFwicGctbG9hZGluZ1wiLCBfdGhpcy5fbG9hZGluZ0h0bWxFbGVtKTtcbiAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uU3VwcG9ydCkge1xuICAgICAgICAgICAgICBfdGhpcy5fbG9hZGluZ0h0bWxFbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkV2ZW50LCBfdGhpcy5fbG9hZGluZ0h0bWxMaXN0ZW5lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX3RoaXMuX2xvYWRpbmdIdG1sVG9EaXNwbGF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9jaGFuZ2VMb2FkaW5nSHRtbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpO1xuICAgICAgICB0aGlzLl9yZW1vdmluZ0h0bWxMaXN0ZW5lciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF90aGlzLl9sb2FkaW5nSHRtbEVsZW0uaW5uZXJIVE1MID0gX3RoaXMuX2xvYWRpbmdIdG1sVG9EaXNwbGF5LnNoaWZ0KCk7XG4gICAgICAgICAgICByZW1vdmVDbGFzcyhcInBnLXJlbW92aW5nXCIsIF90aGlzLl9sb2FkaW5nSHRtbEVsZW0pO1xuICAgICAgICAgICAgYWRkQ2xhc3MoXCJwZy1sb2FkaW5nXCIsIF90aGlzLl9sb2FkaW5nSHRtbEVsZW0pO1xuICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25TdXBwb3J0KSB7XG4gICAgICAgICAgICAgIF90aGlzLl9sb2FkaW5nSHRtbEVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRXZlbnQsIF90aGlzLl9yZW1vdmluZ0h0bWxMaXN0ZW5lcik7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fbG9hZGluZ0h0bWxFbGVtLmFkZEV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkV2ZW50LCBfdGhpcy5fbG9hZGluZ0h0bWxMaXN0ZW5lcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2xvYWRpbmdIdG1sTGlzdGVuZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBQbGVhc2VXYWl0LnByb3RvdHlwZS5maW5pc2ggPSBmdW5jdGlvbihpbW1lZGlhdGVseSwgb25Mb2FkZWRDYWxsYmFjaykge1xuICAgICAgaWYgKGltbWVkaWF0ZWx5ID09IG51bGwpIHtcbiAgICAgICAgaW1tZWRpYXRlbHkgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh3aW5kb3cuZG9jdW1lbnQuaGlkZGVuKSB7XG4gICAgICAgIGltbWVkaWF0ZWx5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmluaXNoaW5nID0gdHJ1ZTtcbiAgICAgIGlmIChvbkxvYWRlZENhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb24oJ29uTG9hZGVkQ2FsbGJhY2snLCBvbkxvYWRlZENhbGxiYWNrKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmxvYWRlZCB8fCBpbW1lZGlhdGVseSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmluaXNoKGltbWVkaWF0ZWx5KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgUGxlYXNlV2FpdC5wcm90b3R5cGUudXBkYXRlT3B0aW9uID0gZnVuY3Rpb24ob3B0aW9uLCB2YWx1ZSkge1xuICAgICAgc3dpdGNoIChvcHRpb24pIHtcbiAgICAgICAgY2FzZSAnYmFja2dyb3VuZENvbG9yJzpcbiAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZGluZ0VsZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdmFsdWU7XG4gICAgICAgIGNhc2UgJ2xvZ28nOlxuICAgICAgICAgIHJldHVybiB0aGlzLl9sb2dvRWxlbS5zcmMgPSB2YWx1ZTtcbiAgICAgICAgY2FzZSAnbG9hZGluZ0h0bWwnOlxuICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUxvYWRpbmdIdG1sKHZhbHVlKTtcbiAgICAgICAgY2FzZSAnb25Mb2FkZWRDYWxsYmFjayc6XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX29uTG9hZGVkQ2FsbGJhY2sgPSB2YWx1ZTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIG9wdGlvbiAnXCIgKyBvcHRpb24gKyBcIidcIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFBsZWFzZVdhaXQucHJvdG90eXBlLnVwZGF0ZU9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB2YXIgaywgdiwgX3Jlc3VsdHM7XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKGsgaW4gb3B0aW9ucykge1xuICAgICAgICB2ID0gb3B0aW9uc1trXTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLnVwZGF0ZU9wdGlvbihrLCB2KSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIFBsZWFzZVdhaXQucHJvdG90eXBlLnVwZGF0ZUxvYWRpbmdIdG1sID0gZnVuY3Rpb24obG9hZGluZ0h0bWwsIGltbWVkaWF0ZWx5KSB7XG4gICAgICBpZiAoaW1tZWRpYXRlbHkgPT0gbnVsbCkge1xuICAgICAgICBpbW1lZGlhdGVseSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2xvYWRpbmdIdG1sRWxlbSA9PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBsb2FkaW5nIHRlbXBsYXRlIGRvZXMgbm90IGhhdmUgYW4gZWxlbWVudCBvZiBjbGFzcyAncGctbG9hZGluZy1odG1sJ1wiKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbW1lZGlhdGVseSkge1xuICAgICAgICB0aGlzLl9sb2FkaW5nSHRtbFRvRGlzcGxheSA9IFtsb2FkaW5nSHRtbF07XG4gICAgICAgIHRoaXMuX3JlYWR5VG9TaG93TG9hZGluZ0h0bWwgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fbG9hZGluZ0h0bWxUb0Rpc3BsYXkucHVzaChsb2FkaW5nSHRtbCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fcmVhZHlUb1Nob3dMb2FkaW5nSHRtbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hhbmdlTG9hZGluZ0h0bWwoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgUGxlYXNlV2FpdC5wcm90b3R5cGUuX2NoYW5nZUxvYWRpbmdIdG1sID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9yZWFkeVRvU2hvd0xvYWRpbmdIdG1sID0gZmFsc2U7XG4gICAgICB0aGlzLl9sb2FkaW5nSHRtbEVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRXZlbnQsIHRoaXMuX2xvYWRpbmdIdG1sTGlzdGVuZXIpO1xuICAgICAgdGhpcy5fbG9hZGluZ0h0bWxFbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkV2ZW50LCB0aGlzLl9yZW1vdmluZ0h0bWxMaXN0ZW5lcik7XG4gICAgICByZW1vdmVDbGFzcyhcInBnLWxvYWRpbmdcIiwgdGhpcy5fbG9hZGluZ0h0bWxFbGVtKTtcbiAgICAgIHJlbW92ZUNsYXNzKFwicGctcmVtb3ZpbmdcIiwgdGhpcy5fbG9hZGluZ0h0bWxFbGVtKTtcbiAgICAgIGlmICh0cmFuc2l0aW9uU3VwcG9ydCkge1xuICAgICAgICBhZGRDbGFzcyhcInBnLXJlbW92aW5nXCIsIHRoaXMuX2xvYWRpbmdIdG1sRWxlbSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkaW5nSHRtbEVsZW0uYWRkRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRXZlbnQsIHRoaXMuX3JlbW92aW5nSHRtbExpc3RlbmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZW1vdmluZ0h0bWxMaXN0ZW5lcigpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBQbGVhc2VXYWl0LnByb3RvdHlwZS5fZmluaXNoID0gZnVuY3Rpb24oaW1tZWRpYXRlbHkpIHtcbiAgICAgIHZhciBsaXN0ZW5lcjtcbiAgICAgIGlmIChpbW1lZGlhdGVseSA9PSBudWxsKSB7XG4gICAgICAgIGltbWVkaWF0ZWx5ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fbG9hZGluZ0VsZW0gPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhZGRDbGFzcyhcInBnLWxvYWRlZFwiLCBkb2N1bWVudC5ib2R5KTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5fb25Mb2FkZWRDYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRoaXMuX29uTG9hZGVkQ2FsbGJhY2suYXBwbHkodGhpcyk7XG4gICAgICB9XG4gICAgICBsaXN0ZW5lciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChfdGhpcy5fbG9hZGluZ0VsZW0pO1xuICAgICAgICAgIHJlbW92ZUNsYXNzKFwicGctbG9hZGluZ1wiLCBkb2N1bWVudC5ib2R5KTtcbiAgICAgICAgICBpZiAoYW5pbWF0aW9uU3VwcG9ydCkge1xuICAgICAgICAgICAgX3RoaXMuX2xvYWRpbmdFbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoYW5pbWF0aW9uRXZlbnQsIGxpc3RlbmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl9sb2FkaW5nRWxlbSA9IG51bGw7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIGlmICghaW1tZWRpYXRlbHkgJiYgYW5pbWF0aW9uU3VwcG9ydCkge1xuICAgICAgICBhZGRDbGFzcyhcInBnLWxvYWRlZFwiLCB0aGlzLl9sb2FkaW5nRWxlbSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkaW5nRWxlbS5hZGRFdmVudExpc3RlbmVyKGFuaW1hdGlvbkV2ZW50LCBsaXN0ZW5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbGlzdGVuZXIoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIFBsZWFzZVdhaXQ7XG5cbiAgfSkoKTtcbiAgcGxlYXNlV2FpdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIHJldHVybiBuZXcgUGxlYXNlV2FpdChvcHRpb25zKTtcbiAgfTtcbiAgZXhwb3J0cy5wbGVhc2VXYWl0ID0gcGxlYXNlV2FpdDtcbiAgcmV0dXJuIHBsZWFzZVdhaXQ7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
