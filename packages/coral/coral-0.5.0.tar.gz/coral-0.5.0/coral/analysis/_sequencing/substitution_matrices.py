import numpy as np


class SubstitutionMatrix(np.ndarray):
    '''Container for a subsitution matrix - is simply a numpy ndarray with an
    additional .alphabet attribute indicating the labels for each row and
    column.'''

    def __new__(cls, matrix, alphabet):
        '''
        :param matrix: A square 2D array-like (e.g. list of lists of numbers or
                       numpy array) corresponding to substitution matrix values
                       (often log-odds, as in BLOSUM62). Note: the
                       SubstitutionMatrix will use use integer values, so any
                       floats will be rounded (standard substitution matrices
                       use integers to speed up calculations).
        :type matrix: 2D array-like: np.ndarray or list of lists of integers
        :param alphabet: A string of the characters to use, in order, for the
                         square subsitution matrix (e.g. 'ATGCN' for a simple
                         5X5 DNA substitution matrix).
        :type alphabet: str

        '''
        obj = np.asarray(matrix).view(cls)
        obj.astype(np.integer)

        obj.alphabet = alphabet

        return obj

    def __array_finalize__(self, obj):
        if obj is None:
            return
        self.alphabet = getattr(obj, 'alphabet', None)


DNA_SIMPLE = SubstitutionMatrix(np.array([[1, -1, -1, -1, -1],
                                          [-1, 1, -1, -1, -1],
                                          [-1, -1, 1, -1, -1],
                                          [-1, -1, -1, 1, -1],
                                          [-1, -1, -1, -1, -1]]),
                                'ATGCN')

DNA = SubstitutionMatrix(
    np.array([[5, -4, -4, -4, -4, 1, 1, -4, -4, 1, -4, -1, -1, -1, -2, -4],
              [-4, 5, -4, -4, -4, 1, -4, 1, 1, -4, -1, -4, -1, -1, -2, 5],
              [-4, -4, 5, -4, 1, -4, 1, -4, 1, -4, -1, -1, -4, -1, -2, -4],
              [-4, -4, -4, 5, 1, -4, -4, 1, -4, 1, -1, -1, -1, -4, -2, -4],
              [-4, -4, 1, 1, -1, -4, -2, -2, -2, -2, -1, -1, -3, -3, -1,
               -4],
              [1, 1, -4, -4, -4, -1, -2, -2, -2, -2, -3, -3, -1, -1, -1, 1],
              [1, -4, 1, -4, -2, -2, -1, -4, -2, -2, -3, -1, -3, -1, -1,
               -4],
              [-4, 1, -4, 1, -2, -2, -4, -1, -2, -2, -1, -3, -1, -3, -1, 1],
              [-4, 1, 1, -4, -2, -2, -2, -2, -1, -4, -1, -3, -3, -1, -1, 1],
              [1, -4, -4, 1, -2, -2, -2, -2, -4, -1, -3, -1, -1, -3, -1,
               -4],
              [-4, -1, -1, -1, -1, -3, -3, -1, -1, -3, -1, -2, -2, -2, -1,
               -1],
              [-1, -4, -1, -1, -1, -3, -1, -3, -3, -1, -2, -1, -2, -2, -1,
               -4],
              [-1, -1, -4, -1, -3, -1, -3, -1, -3, -1, -2, -2, -1, -2, -1,
               -1],
              [-1, -1, -1, -4, -3, -1, -1, -3, -1, -3, -2, -2, -2, -1, -1,
               -1],
              [-2, -2, -2, -2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
               -2],
              [-4, 5, -4, -4, -4, 1, -4, 1, 1, -4, -1, -4, -1, -1, -2, 5]]),
    'ATGCSWRYKMBVHDNU')


BLOSUM62 = SubstitutionMatrix(
    np.array([[4, -1, -2, -2, 0, -1, -1, 0, -2, -1, -1, -1, -1, -2, -1,
               1, 0, -3, -2, 0, -2, -1, -1, -1, -4],
              [-1, 5, 0, -2, -3, 1, 0, -2, 0, -3, -2, 2, -1, -3, -2,
               -1, -1, -3, -2, -3, -1, -2, 0, -1, -4],
              [-2, 0, 6, 1, -3, 0, 0, 0, 1, -3, -3, 0, -2, -3, -2, 1,
               0, -4, -2, -3, 4, -3, 0, -1, -4],
              [-2, -2, 1, 6, -3, 0, 2, -1, -1, -3, -4, -1, -3, -3, -1,
               0, -1, -4, -3, -3, 4, -3, 1, -1, -4],
              [0, -3, -3, -3, 9, -3, -4, -3, -3, -1, -1, -3, -1, -2,
               -3, -1, -1, -2, -2, -1, -3, -1, -3, -1, -4],
              [-1, 1, 0, 0, -3, 5, 2, -2, 0, -3, -2, 1, 0, -3, -1, 0,
               -1, -2, -1, -2, 0, -2, 4, -1, -4],
              [-1, 0, 0, 2, -4, 2, 5, -2, 0, -3, -3, 1, -2, -3, -1, 0,
               -1, -3, -2, -2, 1, -3, 4, -1, -4],
              [0, -2, 0, -1, -3, -2, -2, 6, -2, -4, -4, -2, -3, -3, -2,
               0, -2, -2, -3, -3, -1, -4, -2, -1, -4],
              [-2, 0, 1, -1, -3, 0, 0, -2, 8, -3, -3, -1, -2, -1, -2,
               -1, -2, -2, 2, -3, 0, -3, 0, -1, -4],
              [-1, -3, -3, -3, -1, -3, -3, -4, -3, 4, 2, -3, 1, 0, -3,
               -2, -1, -3, -1, 3, -3, 3, -3, -1, -4],
              [-1, -2, -3, -4, -1, -2, -3, -4, -3, 2, 4, -2, 2, 0, -3,
               -2, -1, -2, -1, 1, -4, 3, -3, -1, -4],
              [-1, 2, 0, -1, -3, 1, 1, -2, -1, -3, -2, 5, -1, -3, -1,
               0, -1, -3, -2, -2, 0, -3, 1, -1, -4],
              [-1, -1, -2, -3, -1, 0, -2, -3, -2, 1, 2, -1, 5, 0, -2,
               -1, -1, -1, -1, 1, -3, 2, -1, -1, -4],
              [-2, -3, -3, -3, -2, -3, -3, -3, -1, 0, 0, -3, 0, 6, -4,
               -2, -2, 1, 3, -1, -3, 0, -3, -1, -4],
              [-1, -2, -2, -1, -3, -1, -1, -2, -2, -3, -3, -1, -2, -4,
               7, -1, -1, -4, -3, -2, -2, -3, -1, -1, -4],
              [1, -1, 1, 0, -1, 0, 0, 0, -1, -2, -2, 0, -1, -2, -1, 4,
               1, -3, -2, -2, 0, -2, 0, -1, -4],
              [0, -1, 0, -1, -1, -1, -1, -2, -2, -1, -1, -1, -1, -2,
               -1, 1, 5, -2, -2, 0, -1, -1, -1, -1, -4],
              [-3, -3, -4, -4, -2, -2, -3, -2, -2, -3, -2, -3, -1, 1,
               -4, -3, -2, 11, 2, -3, -4, -2, -2, -1, -4],
              [-2, -2, -2, -3, -2, -1, -2, -3, 2, -1, -1, -2, -1, 3,
               -3, -2, -2, 2, 7, -1, -3, -1, -2, -1, -4],
              [0, -3, -3, -3, -1, -2, -2, -3, -3, 3, 1, -2, 1, -1, -2,
               -2, 0, -3, -1, 4, -3, 2, -2, -1, -4],
              [-2, -1, 4, 4, -3, 0, 1, -1, 0, -3, -4, 0, -3, -3, -2, 0,
               -1, -4, -3, -3, 4, -3, 0, -1, -4],
              [-1, -2, -3, -3, -1, -2, -3, -4, -3, 3, 3, -3, 2, 0, -3,
               -2, -1, -2, -1, 2, -3, 3, -3, -1, -4],
              [-1, 0, 0, 1, -3, 4, 4, -2, 0, -3, -3, 1, -1, -3, -1, 0,
               -1, -2, -2, -2, 0, -3, 4, -1, -4],
              [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
               -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -4],
              [-4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4,
               -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, 1]]),
    'ARNDCQEGHILKMFPSTWYVBJZX*')
