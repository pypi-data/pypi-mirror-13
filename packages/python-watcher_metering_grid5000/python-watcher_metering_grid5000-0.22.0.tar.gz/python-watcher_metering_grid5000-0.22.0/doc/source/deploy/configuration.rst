..

================================
Configuring the Metering Drivers
================================

This document is continually updated and reflects the latest
available code of this metering driver.

Service overview
================

This module can be used by the `Watcher Metering`_ Agent to collect, periodically, metrics from the grid5000 datacenter.


Activate a Grid5000 driver
==========================

Within your Watcher Metering Agent configuration file ``/etc/watcher-metering/watcher-metering-agent.conf``, add the name of the driver entry point, in the ``[agent]`` section,  you wish to enable.

As an example, if you wish to acticate both the ``grid5000_cpu_user`` and the
``grid5000_disk_free`` drivers, just edit the aforementioned configuration file like
this:

.. code-block:: ini

     [agent]
     driver_names =
        grid5000_cpu_user,
        grid5000_disk_free

After updating the configuration file, you have to restart the `Watcher Metering`_.

.. _`Watcher Metering`: https://github.com/b-com/watcher-metering/


Grid500 Driver configuration
============================

Here is a list of grid5000 drivers currently implemented in this project:

+------------------+-------------------------------------+----------------------+----------------+-----------+
| Metric Name      | Description                         | Platforms            | Unit           | AVAILABLE |
+==================+=====================================+======================+================+===========+
| boottime         | System boot timestamp               | l,f                  | s              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| bread_sec        |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| bwrite_sec       |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| bytes_in         | Number of bytes in per second       | l,f                  | bytes/sec      | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| bytes_out        | Number of bytes out per second      | l,f                  | bytes/sec      | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_aidle        | Percent of time since boot idle CPU | l                    | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_arm          |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_avm          |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_idle         | Percent CPU idle                    | l,f                  | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_intr         |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_nice         | Percent CPU nice                    | l,f                  | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_num          | Number of CPUs                      | l,f                  | CPUs           | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_arm          |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_speed        | Speed in MHz of CPU                 | l,f                  | MHz            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_ssys         |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_system       | Percent CPU system                  | l,f                  | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_user         | Percent CPU user                    | l,f                  | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_vm           |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_wait         |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| cpu_wio          |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| disk_free        | Total free disk space               | l,f                  | GB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| disk_total       | Total available disk space          | l,f                  | GB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| load_fifteen     | Fifteen minute load average         | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| load_five        | Five minute load average            | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| load_one         | One minute load average             | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| location         | GPS coordinates for host            | e                    | (x,y,z)        | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| lread_sec        |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| lwrite_sec       |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| machine_type     |                                     | n/a                  | n/a            | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_buffers      | Amount of buffered memory           | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_cached       | Amount of cached memory             | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_free         | Amount of available memory          | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_shared       | Amount of shared memory             | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_sreclaimable | Amount of slab reclaimable memory   | l (kernel >= 2.6.19) | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mem_total        | Amount of available memory          | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| mtu              | Network maximum transmission unit   | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| os_name          | Operating system name               | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| os_release       | Operating system release (version)  | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| part_max_used    | Max percent used for all partitions | l,f                  | %              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| phread_sec       |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| phwrite_sec      |                                     | n/a                  | 1/sec          | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| pkts_in          | Packets in per second               | l,f                  | packets/sec    | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| pkts_out         | Packets out per second              | l,f                  | packets/sec    | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| proc_run         | Total number of running processes   | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| proc_total       | Total number of processes           | l,f                  | n/a            | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| rcache           |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| swap_free        | Amount of available swap memory     | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| swap_total       | Total amount of swap memory         | l,f                  | KB             | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| sys_clock        | Current time on host                | l,f                  | s              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| wcache           |                                     | n/a                  | %              | NO        |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| pdu              | Power consumption                   | n/a                  | W              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| pdu_shared       | Power consumption                   | n/a                  | W              | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+
| ambient_temp     | Ambient temperature (°C)            | l,f                  | degree celsius | YES       |
+------------------+-------------------------------------+----------------------+----------------+-----------+


Each driver can be also configurable by adding a dedicated section named
``[metrics_driver.driver_name]`` in a configuration file loaded by the Watcher
Metering Agent. Such a file is self documented, so you will find in it all
driver configuration documentation.

You will find a sample by editing the file ``etc/watcher-metering-grid5000/watcher-metering-grid5000.conf.sample``

Once the configuration has been made, you can run the agent. To do so, you can
use the following command:

.. code-block:: shell

    $ watcher-metering-agent \
        --config-file=/etc/watcher-metering/agent.conf
        --config-file=/etc/watcher-metering/watcher-metering-grid5000.conf
